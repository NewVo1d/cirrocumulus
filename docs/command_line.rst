Command Line
----------------

Launch
^^^^^^^^^^^^^^^
::

    cirro launch [--backed] [--host HOST] [--markers [MARKERS [MARKERS ...]]] [--port PORT] [--no-open] [--spatial [SPATIAL [SPATIAL ...]]] dataset [dataset ...]

.. table::
    :widths: auto

    +----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | Positional Arguments                                                                                                                                                                                                                                                                                                       |
    +===================================+========================================================================================================================================================================================================================================================================================+
    | dataset                           | Path to dataset in h5ad, loom, or STAR-Fusion format. Separate multiple datasets with 'a comma instead of a space in order to join datasets by cell id                                                                                                                                 |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | **Optional Arguments**                                                                                                                                                                                                                                                                                                     |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --spatial                         | Directory containing 10x visium spatial data (tissue_hires_image.png, scalefactors_json.json, and tissue_positions_list.csv) or a directory containing `image.png`, `positions.image.csv` with headers barcode, x, and y, and optionally `diameter.image.txt` containing spot diameter |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --markers                         | Path to JSON file that maps name to features. For example {"a":["gene1", "gene2"], "b":["gene3"]}                                                                                                                                                                                      |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --backed                          | Load h5ad file in backed mode                                                                                                                                                                                                                                                          |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --host HOST                       | Host IP address                                                                                                                                                                                                                                                                        |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --port PORT                       | Server port                                                                                                                                                                                                                                                                            |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --no-open                         | Do not open your web browser                                                                                                                                                                                                                                                           |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

The `launch` command opens one or more datasets in h5ad_, loom_, or `STAR-Fusion`_ formats. Seurat objects
can be loaded after converting to h5ad_ or loom_ formats (see vignette_). Annotations and sets that are
created are stored on disk in a JSON format.


Serve
^^^^^^^^^^^^^
::

    cirro serve [--database DATABASE] [--db_uri DB_URI] [--email EMAIL] [--auth_client_id AUTH_CLIENT_ID] [-w WORKERS] [-t TIMEOUT] [-b BIND] [--footer FOOTER] [--upload UPLOAD]


.. table::
    :widths: auto

    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | Optional Arguments                                                                                                                                                                                 |
    +===================================+================================================================================================================================================================+
    | --db_uri                          | MongoDB database connection URI (default mongodb://localhost:27017/)                                                                                           |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --database                        | MongoDB database (default cirrocumulus)                                                                                                                        |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --email                           | Email address that server runs as                                                                                                                              |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --auth_client_id                  | OAuth client id                                                                                                                                                |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --workers                         | The number of worker processes                                                                                                                                 |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --bind                            | Server socket to bind. Server sockets can be any of $(HOST), $(HOST):$(PORT), fd://$(FD), or unix:$(PATH). An IP is a valid $(HOST). (default 127.0.0.1:5000)  |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --footer                          | Markdown file to customize the application footer                                                                                                              |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --upload                          | URL to allow users to upload files                                                                                                                             |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+


The `serve` command starts the cirrocumulus server for use in a shared server environment which can handle concurrent requests from multiple users.
The server can optionally enforce permissions at the dataset level, in order to securely share datasets with collaborators.
Additionally, annotations and sets are created collaboratively among all users authorized to view a dataset and are stored in a database.
The server can be deployed on a cloud VM, an on-premise machine, or on Google App Engine. When deployed in App Engine, the server can be configured
to be use Google Cloud Firestore as a database. Please note that no datasets are available until you import a dataset into cirrocumulus.


Prepare Data
^^^^^^^^^^^^^^
::

    cirro prepare_data [--out OUT] [--backed] [--markers MARKERS] [--groups GROUPS] [--spatial SPATIAL] dataset

.. table::
    :widths: auto

    +----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | Positional Arguments                                                                                                                                                                                                                                                                                                       |
    +===================================+========================================================================================================================================================================================================================================================================================+
    | dataset                           | Path to dataset in h5ad, loom, or Seurat format.                                                                                                                                                                                                                                       |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | **Optional Arguments**                                                                                                                                                                                                                                                                                                     |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --spatial                         | Directory containing 10x visium spatial data (tissue_hires_image.png, scalefactors_json.json, and tissue_positions_list.csv) or a directory containing `image.png`, `positions.image.csv` with headers barcode, x, and y, and optionally `diameter.image.txt` containing spot diameter |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --markers                         | Path to JSON file that maps name to features. For example {"a":["gene1", "gene2"], "b":["gene3"]}                                                                                                                                                                                      |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --backed                          | Load h5ad file in backed mode                                                                                                                                                                                                                                                          |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --groups                          | List of groups to compute markers for (e.g. louvain)                                                                                                                                                                                                                                   |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | --out                             | Path to output directory                                                                                                                                                                                                                                                               |
    +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


The `prepare_data` command is used to freeze an h5ad_, loom_, or Seurat file in cirrocumulus format. The cirrocumulus format allows
efficient partial dataset retrieval over a network (e.g. Google or S3 bucket) using limited memory.

.. _h5ad: https://anndata.readthedocs.io/
.. _loom: https://linnarssonlab.org/loompy/format/
.. _STAR-Fusion: https://github.com/STAR-Fusion/STAR-Fusion/wiki
.. _vignette: https://satijalab.org/seurat/v3.2/conversion_vignette.html

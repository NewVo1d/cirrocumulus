(window.webpackJsonpcirrocumulus=window.webpackJsonpcirrocumulus||[]).push([[0],{151:function(e,t,a){e.exports=a(177)},177:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(12),i=a(26),o=a(50),s=a(113),c=a(30),u=a(64),d=a(244),p=a(221),h=a(109),m=a(114),f=a(13),g=a(17),y=a(14),v=a(15),b=a(128),E=function(e){function t(){return Object(f.a)(this,t),Object(g.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(v.a)(t,e),t}(Object(b.a)(Error)),O=a(16),k=a(71),S=a(34),C=Object(S.a)(".1f"),w=Object(S.a)(","),j=Object(S.a)(".0f"),P={};function M(e){return e.startsWith("interpolate")||(e="interpolate"+e),e}function x(e){return k[M(e)]}P.Diverging=["interpolateBrBG","interpolatePRGn","interpolatePiYG","interpolatePuOr","interpolateRdBu","interpolateRdGy","interpolateRdYlBu","interpolateRdYlGn","interpolateSpectral"],P["Sequential (Single Hue)"]=["interpolateBlues","interpolateGreens","interpolateGreys","interpolateOranges","interpolatePurples","interpolateReds"],P["Sequential (Multi-Hue)"]=["interpolateViridis","interpolateInferno","interpolateMagma","interpolatePlasma","interpolateWarm","interpolateCool","interpolateCubehelixDefault","interpolateBuGn","interpolateBuPu","interpolateGnBu","interpolateOrRd","interpolatePuBuGn","interpolatePuBu","interpolatePuRd","interpolateRdPu","interpolateYlGnBu","interpolateYlGn","interpolateYlOrBr","interpolateYlOrRd"],P.Cyclical=["interpolateRainbow","interpolateSinebow"];var z=function(){function e(){Object(f.a)(this,e)}return Object(O.a)(e,null,[{key:"convertPointsToBins",value:function(e,t){for(var a=[],n=0,r=e.length;n<r;n++)a.push(t[e[n]]);return a}},{key:"convertBinsToPoints",value:function(e,t){for(var a=[],n=0,r=0,l=e.length;r<l;r++)e[r]===t[n]&&(a.push(r),n++);return a}},{key:"createPlotConfig",value:function(){return{showLink:!1,responsive:!1,displaylogo:!1,modeBarButtonsToRemove:["hoverCompareCartesian","hoverClosestCartesian","toggleSpikelines","sendDataToCloud"]}}},{key:"createEmbeddingAxis",value:function(){return{showbackground:!1,autorange:!0,showgrid:!1,zeroline:!1,showline:!1,title:"",autotick:!1,ticks:"",showticklabels:!1}}},{key:"createDotPlotAxis",value:function(){return{showbackground:!1,autorange:!0,showgrid:!1,zeroline:!1,showline:!1,title:"",type:"category"}}},{key:"getEmbeddingChartSize",value:function(e){var t=Math.floor(Math.min(window.screen.availWidth-240,window.screen.availHeight-190));return Math.floor(t/e)}},{key:"createEmbeddingLayout",value:function(t){var a=t.size,n=t.is3d,r={hovermode:"closest",dragmode:"select",width:a=e.getEmbeddingChartSize(a),height:a,margin:{l:0,b:0,r:0,t:0,autoexpand:!1},legend:{yanchor:"top"},autosize:!1,displaylogo:!1,showlegend:!1};return n?r.scene={xaxis:e.createEmbeddingAxis(),yaxis:e.createEmbeddingAxis(),zaxis:e.createEmbeddingAxis()}:(r.xaxis=e.createEmbeddingAxis(),r.yaxis=e.createEmbeddingAxis()),r}},{key:"createDotPlotLayout",value:function(t){var a={hovermode:"closest",dragmode:"select",width:t.width,height:t.height,margin:{l:50,b:50,r:100,t:0,autoexpand:!0},legend:{yanchor:"top"},autosize:!0,displaylogo:!1,showlegend:!1};return a.xaxis=e.createDotPlotAxis(),a.yaxis=e.createDotPlotAxis(),a}}]),e}(),A="/api",D=["email","profile","https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/contacts.readonly","https://www.googleapis.com/auth/devstorage.full_control"],T="SET_UNSELECTED_MARKER_SIZE",_="SET_UNSELECTED_MARKER_SIZE_UI",B="SET_SERVER_INFO",U="SET_CATEGORICAL_FILTER",I="ADD_DATASET",N="DELETE_DATASET",L="UPDATE_DATASET",R="SET_MARKER_SIZE",V="SET_MARKER_OPACITY",H="SET_EMBEDDING_CHART_SIZE",F="SET_UNSELECTED_MARKER_OPACITY",G="SET_SELECTED_VALUE_COUNTS",K="SET_FEATURES",W="SET_GROUP_BY",q="SET_SELECTED_EMBEDDING",Y="SET_NUMBER_OF_BINS",X="SET_BIN_VALUES",J="SET_BIN_SUMMARY",Z="SET_MESSAGE",Q="SET_INTERPOLATOR",$="SET_EMAIL",ee="SET_USER",te="SET_DATASET",ae="SET_DIALOG",ne="EDIT_DATASET_DIALOG",re="IMPORT_DATASET_DIALOG",le="DELETE_DATASET_DIALOG",ie="SET_DATASET_CHOICES",oe="RESTORE_VIEW",se="SET_DOT_PLOT_DATA",ce="SET_EMBEDDING_DATA",ue="SET_LOADING",de="LOADING_APP",pe="SET_NUMBER_OF_BINS_UI",he="SET_MARKER_SIZE_UI",me="SET_MARKER_OPACITY_UI",fe="SET_UNSELECTED_MARKER_OPACITY_UI",ge=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],ye=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];function ve(){return function(e,t){fetch(A+"/user",{headers:{Authorization:"Bearer "+je(),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){return e({type:ee,payload:t})}))}}function be(){return function(e,t){window.gapi.auth2.getAuthInstance().signOut().then((function(){e({type:$,payload:null}),e(Te(null))}))}}function Ee(e){var t=e.dataset.id,a=e.features,n=e.groupBy,r=e.embeddings,l={id:t,embedding:r.length>0?r[0]:null,keys:a.concat(n)};return e.binValues&&(l.nbins=e.numberOfBins),Object.keys(e.categoricalFilter).length>0&&(l.c=e.categoricalFilter),l}function Oe(e,t,a){var n,r=Ee(a());return e.length>0&&(r.p=e),(n=null==r.embedding||0===e.length&&null==r.c?Promise.resolve({}):fetch(A+"/selected_value_counts",{body:JSON.stringify(r),method:"POST",headers:{Authorization:"Bearer "+je()}}).then((function(e){return e.json()}))).then((function(e){return t({type:G,payload:e})})),n}function ke(e){return function(t,a){for(var n,r=e.name,l=e.value,i=e.shiftKey,o=e.metaKey,s=a().categoricalFilter,c=a().embeddingData,u=0;u<c.length;u++)if(c[u].data[0].name===r){n=c[u].colorScale.domain();break}var d=s[r];if(null==d&&(d=[],s[r]=d),i&&d.length>0){var p=n.indexOf(d[d.length-1]),h=n.indexOf(l);if(h>p)for(var m=p;m<=h;m++){var f=d.indexOf(l);-1!==f&&d.splice(f,1),d.push(n[m])}else for(var g=p;g>=h;g--){var y=d.indexOf(l);-1!==y&&d.splice(y,1),d.push(n[g])}}else{var v=d.indexOf(l);o||(d=[],s[r]=d),-1!==v?(d.splice(v,1),0===d.length&&delete s[r]):d.push(l)}t(function(e){return{type:U,payload:e}}(s)),Oe([],t,a)}}function Se(e){var t=null==e||0===e.points.length,a=t?[]:e.points[0].data.selectedpoints;return t||null==e.points[0].data.bins||(a=z.convertPointsToBins(a,e.points[0].data.bins)),function(e,t){Oe(a,e,t)}}function Ce(){return function(e,t){var a=window.location.search.substring(3);if(0!==a.length){var n;try{n=JSON.parse(window.decodeURIComponent(a))}catch(l){return e(xe("Unable to restore saved view."))}if(null!=n.dataset){if(null!=n.colorScheme){var r=x(n.colorScheme);null!=r&&(n.colorScheme={name:n.colorScheme,value:r})}e(Ie(n.dataset)).then((function(){return e({type:oe,payload:n})})).then((function(){return e(Ne({embedding:!0,dotPlot:!0,clear:!0}))})).catch((function(t){console.log(t),e(xe("Unable to restore saved view."))}))}}}}function we(e){return function(t,a){if(window.gapi.auth2.getAuthInstance().isSignedIn.get()){var n=window.gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getEmail();t(_e(n)),t(ve()),t(Re()).then((function(){e&&t(Ce())}))}}}function je(){return"undefined"!==typeof window.gapi?window.gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token:""}function Pe(e){return function(t,a){var n=e.readers,r=e.name,l=e.url;if(""!=r&&""!==l){var i=null!=e.dataset;t(Ae(!0));var o=a().serverInfo.email,s=!i||l!==e.dataset.url;Promise.resolve({ok:!0}).then((function(e){})).then((function(){return fetch(A+"/dataset",{body:JSON.stringify({id:null!=e.dataset?e.dataset.id:null,url:l,name:r,readers:n}),method:i?"PUT":"POST",headers:{Authorization:"Bearer "+je()}})})).then((function(e){return e.json()})).then((function(e){i?(t(function(e){return{type:L,payload:e}}({name:r,id:e.id,owner:!0})),t(xe(s?"Please ensure that "+o+' is a "Storage Object Viewer"':"Dataset updated"))):(t(function(e){return{type:I,payload:e}}({name:r,id:e.id,owner:!0})),t(xe(s?"Please ensure that "+o+' is a "Storage Object Viewer"':"Dataset created")))})).finally((function(){t(Ae(!1)),t(ze(null))})).catch((function(e){Le(t,e)}))}}}function Me(e){return function(t,a){t(Ae(!0)),fetch(A+"/dataset",{body:JSON.stringify({id:e.dataset.id}),method:"DELETE",headers:{Authorization:"Bearer "+je()}}).then((function(){t(function(e){return{type:N,payload:e}}({id:e.dataset.id})),t(xe("Dataset deleted"))})).finally((function(){t(Ae(!1)),t(ze(null))})).catch((function(e){Le(t,e,"Unable to delete dataset. Please try again.")}))}}function xe(e){return{type:Z,payload:e}}function ze(e){return{type:ae,payload:e}}function Ae(e){return{type:ue,payload:e}}function De(e){return{type:de,payload:e}}function Te(e){return{type:te,payload:e}}function _e(e){return{type:$,payload:e}}function Be(e){var t=e;return function(e,a){var n=a(),r=n.dataset.obsCat,l=n.features,i=n.groupBy,o=[],s=[];t.forEach((function(e){-1!==r.indexOf(e)?s.push(e):o.push(e)})),o.length!==l.length&&e(function(e){return function(t,a){var n=a().features;t({type:K,payload:e}),t(Ne({embedding:!0,dotPlot:!0},(function(e){t({type:K,payload:n})})))}}(o)),s.length!==i.length&&e(function(e){return function(t,a){var n=a().groupBy,r=a().categoricalFilter,l=!1;for(var i in r)-1===e.indexOf(i)&&(delete r[i],l=!0);l&&t({type:U,payload:r}),t({type:W,payload:e}),t(Ne({embedding:!0,dotPlot:!0},(function(e){t({type:W,payload:n})})))}}(s))}}function Ue(e){return function(t,a){var n=a().embeddings;t({type:q,payload:e}),t(Ne({embedding:!0,clear:!0},(function(e){t({type:q,payload:n})})))}}function Ie(e){return function(t,a){for(var n=a().datasetChoices,r=null,l=0;l<n.length;l++)if(n[l].id===e){r=n[l];break}if(null!=r)return t(Te({owner:r.owner,name:r.name,id:e,embeddings:[],features:[],obs:[],obsCat:[]})),t(Ae(!0)),fetch([A+"/schema?id="+e].join(""),{headers:{Authorization:"Bearer "+je()}}).then((function(e){return e.json()})).then((function(a){var n;return"1"===a.version&&(n={owner:r.owner,name:r.name,id:e,embeddings:a.embeddings,features:a.var,obsCat:a.obs_cat,nObs:a.n_obs,obs:a.obs}),t(Te(n)),t((function(e,t){var a=t().dataset.embeddings.map((function(e){return e.name})),n={X_fle:1,X_umap:2,X_tsne:3,X_fitsne:4};a.sort((function(e,t){return(e=n[e]||Number.MAX_VALUE)-(t=n[t]||Number.MAX_VALUE)})),a.length>0&&e(Ue([a[0]]))})),n})).finally((function(){t(Ae(!1))})).catch((function(e){Le(t,e,"Unable to retrieve dataset. Please try again.")}));t(xe("Unable to find dataset"))}}function Ne(e,t){return function(a,n){var r=n().features,l=n().groupBy;if(null!=n().dataset){a(Ae(!0));var i=n().dataset.id,o=n().dataset.obs,s=n().embeddings;e.embedding&&0===s.length&&(e.embedding=!1),e.dotPlot&&0===r.length&&(e.dotPlot=!1);var m=n().embeddingData,f=n().embeddingChartSize;e.clear&&(m=[]);var g={},y=r.concat(l),v=0,b=n().markerSize,E=n().markerOpacity,O=n().unselectedMarkerSize,k=n().unselectedMarkerOpacity;m.forEach((function(e){g[e.name]=!0;var t=-1!==y.indexOf(e.name);t&&(e.date=new Date,e.layout=z.createEmbeddingLayout({size:f,is3d:s[0].endsWith("3d"),title:e.name})),e.active=t}));var S=[A+"/slice?id="+i],C=[A+"/slice?id="+i],w=0;r.forEach((function(e){-1===o.indexOf(e)&&(C.push("&key="+e),w++),null!=g[e]||(v++,S.push("&key="+e))})),(e.embedding||e.dotPlot)&&l.forEach((function(e){C.push("&key="+e),null!=g[e]||(v++,S.push("&key="+e))}));var j=n().numberOfBins>0&&n().binValues;e.embedding&&j&&(S.push("&nbins="+n().numberOfBins),S.push("&reduce_function="+n().binSummary)),e.embedding&&s.length>0&&s.forEach((function(e){return S.push("&embedding="+e)}));var P=n().interpolator,M=[];if(e.dotPlot){var x=null;x=w>0&&l.length>0?fetch(C.join(""),{headers:{Authorization:"Bearer "+je()}}).then((function(e){return e.json()})):Promise.resolve({stats:{}}),M.push(x),x.then((function(e){var t;a((t=e.dotplot||null,{type:se,payload:t}))}))}if(e.embedding){var D,T=Oe([],a,n);D=0===v&&m.filter((function(e){return e.active})).length>0?Promise.resolve({embedding:{coordinates:{},values:{}}}):fetch(S.join(""),{headers:{Authorization:"Bearer "+je()}}).then((function(e){return e.json()})),M.push(D),M.push(T);var _=Object(u.a)().domain([0,255]).range([0,1]);Promise.all([D,T]).then((function(e){var t,r=e[0],l=n().selectedValueCounts,i=r.embedding.values,o=r.embedding.summary,u=r.embedding.coordinates,g=r.embedding.bins,y=s[0].endsWith("3d"),v=l.indices;for(var S in null!=l.bins&&(v=z.convertBinsToPoints(g,l.bins)),null!=v&&0===v.length&&(v=null),i){var C=u[s[0]+"_1"],w=u[s[0]+"_2"],j=u[s[0]+"_3"],M=i[S],x="count"!==S&&null!=o[S]&&null==o[S].mean,A=null,D=null,T=null;if(x){var B=o[S].values;(A=Object(p.a)(B.length<=10?h.a:B.length<=20?ge:ge.concat(ye)).domain(B)).summary=o[S]}else{D=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(var U=0,I=M.length;U<I;U++){var N=M[U];D=N<D?N:D,T=N>T?N:T}(A=Object(d.a)(P.value).domain([D,T])).summary=r.embedding.summary[S]}for(var L=[],R=0,V=M.length;R<V;R++){var H=Object(c.e)(A(M[R]));L.push([_(H.r),_(H.g),_(H.b)])}var F={hoverinfo:"text",showlegend:!1,name:S,mode:"markers",type:y?"scatter3d":"scattergl",hoveron:"points",x:C,y:w,bins:g,marker:{size:b,color:L,opacity:E,showscale:!1},unselected:{marker:{opacity:k,size:O}},selectedpoints:v,values:M,text:M};y&&(F.z=j),F=[F],m.push({date:new Date,active:!0,colorScale:A,continuous:!x,data:F,name:S,layout:z.createEmbeddingLayout({size:f,is3d:y,title:S}),isCategorical:x})}m.sort((function(e,t){return(e=e.name.toLowerCase())<(t=t.name.toLowerCase())?-1:1})),a((t=m.slice(0),{type:ce,payload:t}))}))}Promise.all(M).finally((function(){a(Ae(!1))})).catch((function(e){Le(a,e,"Unable to retrieve data. Please try again."),t&&t(e)}))}}}function Le(e,t,a){if(console.log(t),401===t.status)return e(xe("Your session has expired. Please login again.")),e(be());null==a&&(a=t instanceof E?t.message:"An unexpected error occurred. Please try again."),e(xe(new Error(a)))}function Re(){return function(e,t){return e(Ae(!0)),fetch(A+"/datasets",{headers:{Authorization:"Bearer "+je()}}).then((function(e){return e.json()})).then((function(t){e({type:ie,payload:t})})).finally((function(){e(Ae(!1))})).catch((function(t){Le(e,t,"Unable to retrieve datasets. Please try again.")}))}}var Ve=a(254),He=a(239),Fe=a(129),Ge=a(246),Ke=a(241),We=a(229),qe=a(231),Ye=a(222),Xe=a(226),Je=a(248),Ze=a(232),Qe=a(243),$e=a(247),et=a(235),tt=a(245),at=a(63),nt=a.n(at),rt=a(242),lt=a(124),it=a.n(lt),ot=a(125),st=a.n(ot),ct=a(120),ut=a.n(ct),dt=a(79),pt=a.n(dt),ht=a(122),mt=a.n(ht),ft=a(123),gt=a.n(ft),yt=a(228),vt=a(227),bt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(g.a)(this,Object(y.a)(t).call(this,e))).handleClose=function(){a.props.handleCancel()},a.handleDelete=function(){a.setState({loading:!0}),a.props.handleDelete({dataset:a.props.dataset})},a.state={open:!0},a}return Object(v.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){return r.a.createElement(Ye.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"delete-dataset-dialog-title",fullWidth:!0,maxWidth:"sm"},r.a.createElement(Xe.a,{id:"delete-dataset-dialog-title"},"Delete Dataset"),r.a.createElement(vt.a,null,r.a.createElement("h3",null,"Are you sure you want to delete ",this.props.dataset.name,"?")),r.a.createElement(yt.a,null,r.a.createElement(We.a,{disabled:this.state.loading,onClick:this.handleClose,color:"primary"},"Cancel"),r.a.createElement(We.a,{disabled:this.state.loading,onClick:this.handleDelete,color:"primary"},"Delete ",r.a.createElement(pt.a,null))))}}]),t}(r.a.PureComponent),Et=Object(i.b)((function(e){return{dataset:e.dataset,email:e.email}}),(function(e){return{handleDelete:function(t){e(Me(t))},handleCancel:function(t){e(ze(null))}}}))(bt),Ot=a(116),kt=a.n(Ot),St=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(g.a)(this,Object(y.a)(t).call(this,e))).handleStart=function(e){},a.handleDrag=function(e,t){},a.handleStop=function(e){},a.ref=r.a.createRef(),a.backingScale=1,a}return Object(v.a)(t,e),Object(O.a)(t,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),a=this.props.height,n=this.props.width;t.clearRect(0,0,n*e,a*e),t.scale(e,e);var r=this.props.scale;if(null!=r){var l=r.domain();if(l[0]!==l[1]){for(var i=l[0],o=this.props.nsteps||10,s=(l[1]-l[0])/o,c=t.createLinearGradient(0,0,n,20),d=Object(u.a)().range([0,1]).domain(l).clamp(!0),p=0;p<o;p++){p===o-1&&(i=l[1]);var h=d(i);if(!isNaN(h)){var m=r(i);c.addColorStop(h,m)}i+=s}t.fillStyle=c,t.fillRect(0,0,n,20),t.strokeStyle="LightGrey",t.strokeRect(0,0,n,20),this.props.label>0&&(t.font="12px Helvetica",t.textBaseline="top",t.fillStyle="black",t.textAlign="left",t.fillText(C(l[0]),0,22),t.textAlign="right",t.fillText(C(l[1]),n,22)),t.setTransform(1,0,0,1,0,0)}}}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"componentDidUpdate",value:function(e,t,a){this.redraw()}},{key:"render",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio),this.backingScale=e;var t=this.props.height,a=this.props.width,n={width:a,height:t,display:"block"};return this.props.style&&(n=Object.assign({},n,this.props.style)),r.a.createElement("canvas",{width:a*e,height:t*e,ref:this.ref,style:n})}}]),t}(r.a.PureComponent),Ct=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(g.a)(this,Object(y.a)(t).call(this,e))).ref=r.a.createRef(),a.backingScale=1,a}return Object(v.a)(t,e),Object(O.a)(t,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),a=this.props.height,n=this.props.width;t.clearRect(0,0,n*e,a*e),t.scale(e,e);var r=this.props.scale;if(null!=r){var l=r.domain(),i=l[0],o=this.props.nsteps||3,s=(l[1]-l[0])/o,c=Object(u.a)().range([25,n-25]).domain([0,o-1]).clamp(!0),d=Object(u.a)().range([2,10]).domain(l).clamp(!0);t.font="12px Helvetica",t.textBaseline="top",t.fillStyle="black",t.textAlign="center";for(var p=0;p<o;p++){p===o-1&&(i=l[1]);var h=c(p),m=d(i);t.beginPath(),t.arc(h,10,m,0,2*Math.PI),t.stroke(),t.fillText(j(100*i),h,22),i+=s}t.setTransform(1,0,0,1,0,0)}}},{key:"componentDidUpdate",value:function(e,t,a){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"render",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio),this.backingScale=e;var t=this.props.height,a=this.props.width,n={width:a,height:t};return this.props.style&&(n=Object.assign({},n,this.props.style)),r.a.createElement("canvas",{width:a*e,height:t*e,ref:this.ref,style:n})}}]),t}(r.a.PureComponent),wt=kt()(window.Plotly),jt=function(e){function t(){return Object(f.a)(this,t),Object(g.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){if(null==this.props.data)return r.a.createElement("div",null);var e=this.props.data,t=e.index||[""],a=Number.MAX_VALUE,n=-Number.MAX_VALUE,l=Number.MAX_VALUE,i=-Number.MAX_VALUE,o={};for(var s in e)if("index"!==s){var c=e[s],d=void 0,p=void 0,h=s.indexOf(","),m=s.substring(2,h-1),f=s.substring(h+3,s.length-2),g=o[m];void 0===g&&(g={},o[m]=g),"non_zero"===f?(d=l,p=i,g.fraction=c):"mean"===f?(d=a,p=n,g.summary=c):console.log("Unknown type: "+f+".");for(var y=0;y<c.length;y++)d=Math.min(d,c[y]),p=Math.max(p,c[y]);"non_zero"===f?(l=d,i=p):(a=d,n=p)}a===n&&n++,l===i&&(l=0,i=1);var v=Object(u.a)().domain([a,n]).range(["blue","red"]),b=Object(u.a)().domain([l,i]).range([1,14]).clamp(!0),E=[],O=[],k=[],S=[],w=[],j=[];for(var P in o){j.push(P);for(var M=o[P],x=M.summary,A=M.fraction,D=0;D<x.length;D++)O.push(v(x[D])),E.push(b(A[D])),S.push(P),k.push(t[D]),w.push("mean: "+C(x[D])+", % non-zero: "+C(100*A[D]))}var T=[{type:"scatter",x:k,y:S,text:w,mode:"markers",name:"",sizemode:"diameter",marker:{color:O,symbol:"circle",size:E}}],_=z.createPlotConfig(),B=z.createDotPlotLayout({height:100+16*j.length,width:Math.max(300,70+16*t.length)});return r.a.createElement("div",{style:{maxWidth:800,overflow:"auto",border:"1px solid LightGrey"}},r.a.createElement(wt,{data:T,layout:B,config:_}),r.a.createElement(St,{style:{display:"block"},width:300,label:!0,height:40,scale:v}),r.a.createElement(Ct,{style:{display:"block"},width:150,label:!0,height:40,scale:b}))}}]),t}(r.a.PureComponent),Pt=Object(i.b)((function(e){return{data:e.dotPlotData}}),(function(e){return{}}))(jt),Mt=a(249),xt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(g.a)(this,Object(y.a)(t).call(this,e))).handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.datasetName.trim(),t=a.state.url.trim();if(""!==e&&""!==t){a.setState({loading:!0});for(var n=a.state.readers.split(","),r=new Set,l=0;l<n.length;l++){var i=n[l].trim().toLowerCase();""!==i&&r.add(i)}var o=Array.from(r);a.props.handleSave({dataset:a.props.dataset,name:e,url:t,readers:o})}},a.onEmailChanged=function(e){a.setState({readers:e.target.value})},a.onUrlChanged=function(e){a.setState({url:e.target.value})},a.onDatasetNameChanged=function(e){a.setState({datasetName:e.target.value})},a.state={url:"",datasetName:null!=a.props.dataset?a.props.dataset.name:"",readers:"",loading:null!=a.props.dataset},a}return Object(v.a)(t,e),Object(O.a)(t,[{key:"componentDidMount",value:function(){var e=this;null!=this.props.dataset&&fetch(A+"/dataset?id="+this.props.dataset.id,{method:"GET",headers:{Authorization:"Bearer "+je()}}).then((function(e){return e.json()})).then((function(t){var a=[];for(var n in t.roles)"reader"===t[n]&&a.push(n);e.setState({datasetName:t.name,loading:!1,url:t.url,readers:a.join(", ")})})).catch((function(t){e.props.handleError("Unable to retrieve dataset details. Please try again."),e.props.handleCancel()}))}},{key:"render",value:function(){return r.a.createElement(Ye.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-dataset-dialog-title",fullWidth:!0,maxWidth:"sm"},r.a.createElement(Xe.a,{id:"edit-dataset-dialog-title"},null==this.props.dataset?"Import":"Edit"," Dataset"),r.a.createElement(vt.a,null,this.state.loading&&r.a.createElement(qe.a,null),r.a.createElement(Mt.a,{disabled:this.state.loading,required:!0,value:this.state.datasetName,onChange:this.onDatasetNameChanged,margin:"dense",label:"Dataset name",fullWidth:!0}),!this.state.loading&&r.a.createElement(Mt.a,{required:!0,value:this.state.url,onChange:this.onUrlChanged,margin:"dense",helperText:"Please ensure that "+this.props.serverEmail+' has "Storage Object Viewer" permissions',label:"Dataset URL (gs://my_bucket/my_dataset.parquet)",fullWidth:!0}),!this.state.loading&&r.a.createElement(Mt.a,{value:this.state.readers,onChange:this.onEmailChanged,margin:"dense",label:"Comma separated list of emails to share with",fullWidth:!0,multiline:!0})),r.a.createElement(yt.a,null,r.a.createElement(We.a,{disabled:this.state.loading,onClick:this.handleClose,color:"primary"},"Cancel"),r.a.createElement(We.a,{disabled:this.state.loading,onClick:this.handleSave,color:"primary"},"Save")))}}]),t}(r.a.PureComponent),zt=Object(i.b)((function(e){return{dataset:e.dialog===ne?e.dataset:null,serverEmail:e.serverInfo.email}}),(function(e){return{handleSave:function(t){e(Pe(t))},handleCancel:function(t){e(ze(null))},handleError:function(t){e(xe(t))}}}))(xt),At=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(g.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).handleClick=function(e,t,n){a.props.clickEnabled&&(n.preventDefault(),a.props.handleClick({name:a.props.name,value:e,shiftKey:n.shiftKey,metaKey:n.metaKey}))},a}return Object(v.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.scale,n=t.categoricalFilter,l=t.name,i=t.selectedValueCounts,o=t.maxHeight,s=t.clickEnabled,c=n[l],u=null!=this.props.domain?this.props.domain:a.domain(),d=null!=i.summary?i.summary[l]:null;return r.a.createElement("div",{style:{display:"inline-block",padding:10,verticalAlign:"top",maxHeight:o,overflow:"auto"}},r.a.createElement("b",null,l),r.a.createElement("table",null,r.a.createElement("tbody",null,u.map((function(t,n){var l=function(e,t,a,n){if(null==t.summary.total){for(var r=0,l=0,i=t.summary.counts.length;l<i;l++)r+=t.summary.counts[l];t.summary.total=r}var o,s=t.summary.counts[a],c=t.summary.total,u=s/c,d=Number.NaN,p=w(s)+" / "+w(c)+" ("+C(100*u)+"% of total)";if(null!=e)if(null!=e.mean)o="mean "+e.mean;else{var h=e[t.summary.values[a]]||0;d=h/n,o=w(h)+" / "+w(n)+" ("+C(100*d)+"%)"}return{percentTotal:u,percentSelected:d,title:p,total:w(c),selectionTitle:o}}(d,a,n,i.count),o=null==c||-1!==c.indexOf(t)?1:.4,u=60*l.percentTotal,p=60*l.percentSelected;return r.a.createElement("tr",{style:{cursor:s?"pointer":null,opacity:o},onClick:function(a){return e.handleClick(t,n,a)},key:t},s&&r.a.createElement("td",null,r.a.createElement("div",{style:{display:"inline-block",width:10,height:10,background:a(t)}})),r.a.createElement("td",null,r.a.createElement("div",{style:{maxWidth:140,textOverflow:"ellipsis",overflow:"hidden",display:"inline-block",userSelect:"none"},title:""+t},""+t)),isNaN(p)?null:r.a.createElement("td",null,r.a.createElement("div",{title:l.selectionTitle,style:{display:"inline-block",position:"relative",width:60,border:"1px solid black",height:9}},r.a.createElement("div",{style:{position:"absolute",width:p,left:0,top:0,backgroundColor:"LightGrey",height:9}}))),r.a.createElement("td",null,r.a.createElement("div",{title:l.title,style:{display:"inline-block",position:"relative",width:60,border:"1px solid black",height:9}},r.a.createElement("div",{style:{position:"absolute",width:u,left:0,top:0,backgroundColor:"LightGrey",height:9}}))))}))),r.a.createElement("tfoot",null,r.a.createElement("tr",null,s&&r.a.createElement("td",null),r.a.createElement("td",null),null!=d?r.a.createElement("td",null,r.a.createElement("small",null,"selection")):null,r.a.createElement("td",null,r.a.createElement("small",null,null!=d?"group":null))))))}}]),t}(r.a.PureComponent),Dt=function(e){function t(){return Object(f.a)(this,t),Object(g.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(O.a)(t,[{key:"getChartData",value:function(e){var t,a={xaxis:{showbackground:!1,autorange:!0,showgrid:!1,zeroline:!1,showline:!1,title:""},yaxis:{showbackground:!1,autorange:!0,showgrid:!1,zeroline:!1,showline:!1,title:""},dragmode:!1,hovermode:"x",width:180,height:70,margin:{l:e.length>1?70:0,b:0,r:0,t:0,autoexpand:!0},autosize:!0,displaylogo:!1,showlegend:!1};return e.length>1?t=["All","Selection"]:1===e.length&&(t=[""]),{data:[{hoverinfo:"none",x:e.map((function(e){return e.mean})),y:t,sizemode:"diameter",marker:{shape:"circle"},error_x:{type:"data",array:e.map((function(e){return e.variance}))},type:"scatter",mode:"markers"}],layout:a,config:{displayModeBar:!1}}}},{key:"render",value:function(){var e=this.props,t=e.name,a=e.selectedValueCounts,n=e.maxHeight,l=e.summary,i=e.nTotal,o=null!=a.summary?a.summary[t]:null,s=[],c=[i];l&&s.push(l),o&&(s.push(o),c.push(a.count));var u=this.getChartData(s);return r.a.createElement("div",{style:{display:"inline-block",padding:10,verticalAlign:"top",maxHeight:n,overflow:"auto"}},r.a.createElement("b",null,t),s.length>0&&r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",null,"Mean"),r.a.createElement("td",null,"Variance"),r.a.createElement("td",null,"% Expressed"))),r.a.createElement("tbody",null,s.map((function(e,t){return r.a.createElement("tr",{key:t},r.a.createElement("td",null,u.data[0].y[t]),r.a.createElement("td",null,C(e.mean)),r.a.createElement("td",null,C(e.variance)),r.a.createElement("td",null,w(Math.round(e.num_expressed/c[t]*100))))})))))}}]),t}(r.a.PureComponent),Tt=function(e){function t(){return Object(f.a)(this,t),Object(g.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this.props,t=e.scale,a=e.name,n=e.selectedValueCounts,l=e.maxHeight,i=e.nTotal,o=e.style;return r.a.createElement("div",{style:{display:"inline-block",padding:10,verticalAlign:"top",maxHeight:l,overflow:"auto"}},r.a.createElement(Dt,{name:a,nTotal:i,summary:t.summary,selectedValueCounts:n,maxHeight:l}),r.a.createElement(St,{width:this.props.width,height:this.props.height,style:o,scale:t,label:this.props.label}))}}]),t}(r.a.PureComponent),_t=a(44),Bt=a(7),Ut=a.n(Bt),It=["AfterExport","AfterPlot","Animated","AnimatingFrame","AnimationInterrupted","AutoSize","BeforeExport","ButtonClicked","Click","ClickAnnotation","Deselect","DoubleClick","Framework","Hover","LegendClick","LegendDoubleClick","Relayout","Restyle","Redraw","Selected","Selecting","SliderChange","SliderEnd","SliderStart","Transitioning","TransitionInterrupted","Unhover"],Nt=["plotly_restyle","plotly_redraw","plotly_relayout","plotly_doubleclick","plotly_animated"],Lt="undefined"!==typeof window;var Rt=function(e){var t=function(t){function a(e){var t;return Object(f.a)(this,a),(t=Object(g.a)(this,Object(y.a)(a).call(this,e))).p=Promise.resolve(),t.resizeHandler=null,t.handlers={},t.syncWindowResize=t.syncWindowResize.bind(Object(_t.a)(t)),t.syncEventHandlers=t.syncEventHandlers.bind(Object(_t.a)(t)),t.attachUpdateEvents=t.attachUpdateEvents.bind(Object(_t.a)(t)),t.getRef=t.getRef.bind(Object(_t.a)(t)),t.handleUpdate=t.handleUpdate.bind(Object(_t.a)(t)),t.figureCallback=t.figureCallback.bind(Object(_t.a)(t)),t.updatePlotly=t.updatePlotly.bind(Object(_t.a)(t)),t}return Object(v.a)(a,t),Object(O.a)(a,[{key:"updatePlotly",value:function(t,a,n){var r=this;this.p=this.p.then((function(){var t;if(!r.el)throw r.unmounting?(t=new Error("Component is unmounting")).reason="unmounting":t=new Error("Missing element reference"),t;return e.newPlot(r.el,{data:r.props.data,layout:r.props.layout,config:r.props.config,frames:r.props.frames})})).then((function(){return r.syncWindowResize(t)})).then(this.syncEventHandlers).then((function(){return r.figureCallback(a)})).then(n?this.attachUpdateEvents:function(){}).catch((function(e){"unmounting"!==e.reason&&(console.error("Error while plotting:",e),r.props.onError&&r.props.onError(e))}))}},{key:"componentDidMount",value:function(){this.unmounting=!1,this.updatePlotly(!0,this.props.onInitialized,!0)}},{key:"componentDidUpdate",value:function(e){this.unmounting=!1;var t=e.frames&&e.frames.length?e.frames.length:0,a=this.props.frames&&this.props.frames.length?this.props.frames.length:0,n=!(e.layout===this.props.layout&&e.data===this.props.data&&e.config===this.props.config&&a===t),r=void 0!==e.revision,l=e.revision!==this.props.revision;(n||r&&(!r||l))&&this.updatePlotly(!0,this.props.onUpdate,!0)}},{key:"componentWillUnmount",value:function(){this.unmounting=!0,this.figureCallback(this.props.onPurge),this.resizeHandler&&Lt&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.removeUpdateEvents(),e.purge(this.el)}},{key:"attachUpdateEvents",value:function(){var e=this;this.el&&this.el.removeListener&&Nt.forEach((function(t){e.el.on(t,e.handleUpdate)}))}},{key:"removeUpdateEvents",value:function(){var e=this;this.el&&this.el.removeListener&&Nt.forEach((function(t){e.el.removeListener(t,e.handleUpdate)}))}},{key:"handleUpdate",value:function(){this.figureCallback(this.props.onUpdate)}},{key:"figureCallback",value:function(e){if("function"===typeof e){var t=this.el;e({data:t.data,layout:t.layout,frames:this.el._transitionData?this.el._transitionData._frames:null},this.el)}}},{key:"syncWindowResize",value:function(t){var a=this;Lt&&(this.props.useResizeHandler&&!this.resizeHandler?(this.resizeHandler=function(){return e.Plots.resize(a.el)},window.addEventListener("resize",this.resizeHandler),t&&this.resizeHandler()):!this.props.useResizeHandler&&this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null))}},{key:"getRef",value:function(e){this.el=e,this.props.debug&&Lt&&(window.gd=this.el)}},{key:"syncEventHandlers",value:function(){var e=this;It.forEach((function(t){var a=e.props["on"+t],n=e.handlers[t];Boolean(n)&&e.removeEventHandler(t),a&&e.addEventHandler(t,a)}))}},{key:"addEventHandler",value:function(e,t){this.handlers[e]=t,this.el.on(this.getPlotlyEventName(e),this.handlers[e])}},{key:"removeEventHandler",value:function(e){this.el.removeListener(this.getPlotlyEventName(e),this.handlers[e]),delete this.handlers[e]}},{key:"getPlotlyEventName",value:function(e){return"plotly_"+e.toLowerCase()}},{key:"render",value:function(){return r.a.createElement("div",{id:this.props.divId,style:this.props.style,ref:this.getRef,className:this.props.className})}}]),a}(n.Component);return t.propTypes&&It.forEach((function(e){t.propTypes["on"+e]=Ut.a.func})),t.defaultProps={debug:!1,useResizeHandler:!1,data:[],style:{position:"relative",display:"inline-block"}},t}(window.Plotly),Vt=function(e){function t(e){return Object(f.a)(this,t),Object(g.a)(this,Object(y.a)(t).call(this,e))}return Object(v.a)(t,e),Object(O.a)(t,[{key:"getKey",value:function(e){var t=e.name;return this.props.binValues&&(t+="-"+this.props.numberOfBins),t}},{key:"getPlots",value:function(){var e=this,t=this.props.data.filter((function(e){return e.active})),a=this.props.nObs,n=z.getEmbeddingChartSize(1===t.length?1:this.props.embeddingChartSize);return t.map((function(t){return n!==t.layout.width&&(t.layout=Object.assign({},t.layout),t.layout.width=n,t.layout.height=n),r.a.createElement("div",{style:{display:"inline-block",border:"1px solid LightGrey"},key:t.name},r.a.createElement(Rt,{data:t.data,layout:t.layout,config:e.props.config,onDeselect:e.props.onDeselect,onSelected:e.props.onSelect}),t.continuous?r.a.createElement(Tt,{width:186,label:!0,height:40,nTotal:a,scale:t.colorScale,selectedValueCounts:e.props.selectedValueCounts,maxHeight:t.layout.height,name:t.name}):r.a.createElement(At,{categoricalFilter:e.props.categoricalFilter,handleClick:e.props.handleLegendClick,name:t.name,scale:t.colorScale,maxHeight:t.layout.height,clickEnabled:!0,selectedValueCounts:e.props.selectedValueCounts}))}))}},{key:"render",value:function(){return this.getPlots()}}]),t}(r.a.PureComponent),Ht=Object(i.b)((function(e){return{nObs:e.dataset.nObs,data:e.embeddingData,numberOfBins:e.numberOfBins,binValues:e.binValues,embeddingChartSize:e.embeddingChartSize,config:e.plotConfig,categoricalFilter:e.categoricalFilter,selectedValueCounts:e.selectedValueCounts}}),(function(e){return{handleLegendClick:function(t){e(ke(t))},onSelect:function(t){e(Se(t))},onDeselect:function(){e(Se(null))}}}))(Vt),Ft=a(253),Gt=a(240),Kt=a(234),Wt=a(238),qt=a(251),Yt=a(237),Xt=a(56),Jt=a(93),Zt=a(130),Qt=a(252),$t=a(230),ea=a(94),ta=a(6),aa=a(90),na=a(119),ra=a.n(na),la=a(117),ia=a.n(la),oa=a(126);function sa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ca(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?sa(a,!0).forEach((function(t){Object(Jt.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):sa(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ua={display:"flex",alignItems:"center",justifyContent:"space-between"},da=function(e){return r.a.createElement("div",{style:ua},r.a.createElement("span",null,e.label))};function pa(e){var t=e.inputRef,a=Object(Zt.a)(e,["inputRef"]);return r.a.createElement("div",Object.assign({ref:t},a))}var ha={Control:function(e){return r.a.createElement(Mt.a,Object.assign({fullWidth:!0,InputProps:{inputComponent:pa,inputProps:ca({className:e.selectProps.classes.input,inputRef:e.innerRef,children:e.children},e.innerProps)}},e.selectProps.textFieldProps))},Menu:function(e){return r.a.createElement(ea.a,Object.assign({square:!0,className:e.selectProps.classes.paper},e.innerProps),e.children)},MultiValue:function(e){return r.a.createElement(Qt.a,{tabIndex:-1,label:e.children,className:ia()(e.selectProps.classes.chip,Object(Jt.a)({},e.selectProps.classes.chipFocused,e.isFocused)),onDelete:e.removeProps.onClick,deleteIcon:r.a.createElement(ra.a,e.removeProps)})},NoOptionsMessage:function(e){return r.a.createElement(Xt.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.noOptionsMessage},e.innerProps),e.children)},Option:function(e){return r.a.createElement($e.a,Object.assign({buttonRef:e.innerRef,selected:e.isFocused,component:"div",style:{fontWeight:e.isSelected?500:400}},e.innerProps),e.children)},Placeholder:function(e){return r.a.createElement(Xt.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.placeholder},e.innerProps),e.children)},SingleValue:function(e){return r.a.createElement(Xt.a,Object.assign({className:e.selectProps.classes.singleValue},e.innerProps),e.children)},ValueContainer:function(e){return r.a.createElement("div",{className:e.selectProps.classes.valueContainer},e.children)}},ma=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(g.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).loadOptions=function(e,t){return t(a.filterOptions(e))},a.noOptionsMessage=function(){return"No matches"},a.onChange=function(e){a.props.isMulti?a.props.onChange(null==e||0===e.length?null:e.map((function(e){return e.value}))):a.props.onChange(e)},a.filterOptions=function(e){if(e){for(var t=1===(e=e.toLowerCase()).length?3:2===e.length?10:20,n=0,r=[],l=0,i=a.props.options.length;l<i;l++){var o=a.props.options[l],s={label:o.label,options:[]};r.push(s);for(var c=0,u=o.options.length;c<u;c++){var d=o.options[c];if(d.value.toLowerCase().startsWith(e)&&(n++,s.options.push(d),n===t))return r}}return r}return[]},a}return Object(v.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.theme,n={input:function(e){return ca({},e,{color:a.palette.text.primary,"& input":{font:"inherit"}})}};return r.a.createElement("div",{className:t.root},r.a.createElement($t.a,null,r.a.createElement(oa.a,{noOptionsMessage:this.noOptionsMessage,cacheOptions:!1,placeholder:"",loadOptions:this.loadOptions,classes:t,styles:n,textFieldProps:{label:this.props.label,helperText:this.props.helperText,InputLabelProps:{shrink:!0}},formatGroupLabel:da,components:ha,onChange:this.onChange,value:this.props.value,isMulti:this.props.isMulti,defaultOptions:this.props.defaultOptions})))}}]),t}(r.a.Component),fa=Object(ta.a)((function(e){return{root:{flexGrow:1},input:{display:"flex",padding:0,maxWidth:"220px",height:"100%"},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:"".concat(e.spacing(1)/2,"px ").concat(e.spacing(1)/4,"px")},chipFocused:{backgroundColor:Object(aa.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:"".concat(e.spacing(1),"px ").concat(2*e.spacing(1),"px")},singleValue:{fontSize:16},placeholder:{position:"absolute",left:2,fontSize:16},paper:{position:"absolute",zIndex:1,marginTop:e.spacing(1),left:0,right:0},divider:{height:2*e.spacing(1)}}}),{withTheme:!0})(ma),ga=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(g.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).handleInterpolatorChange=function(e){var t=e.target.value;a.props.handleInterpolator({name:t,value:x(t)})},a}return Object(v.a)(t,e),Object(O.a)(t,[{key:"getScale",value:function(e){return Object(d.a)(k[e]).domain([0,1])}},{key:"render",value:function(){var e=this,t=this.props.classes,a=M(this.props.interpolator.name);return r.a.createElement(tt.a,{input:r.a.createElement(Ze.a,{id:"color-scheme"}),className:t.select,onChange:this.handleInterpolatorChange,value:a,multiple:!1},r.a.createElement($e.a,{key:"Diverging",value:"Diverging",divider:!0,disabled:!0},"Diverging"),P.Diverging.map((function(t){return r.a.createElement($e.a,{value:t,key:t},r.a.createElement(St,{width:200,label:!1,height:24,scale:e.getScale(t)}))})),r.a.createElement($e.a,{key:"Sequential (Single Hue)",value:"Sequential (Single Hue)",divider:!0,disabled:!0},"Sequential (Single Hue)"),P["Sequential (Single Hue)"].map((function(t){return r.a.createElement($e.a,{value:t,key:t},r.a.createElement(St,{width:200,label:!1,height:20,scale:e.getScale(t)}))})),r.a.createElement($e.a,{key:"Sequential (Multi-Hue)",value:"Sequential (Multi-Hue)",divider:!0,disabled:!0},"Sequential (Multi-Hue)"),P["Sequential (Multi-Hue)"].map((function(t){return r.a.createElement($e.a,{value:t,key:t},r.a.createElement(St,{width:200,label:!1,height:20,scale:e.getScale(t)}))})),r.a.createElement($e.a,{key:"Cyclical",value:"Cyclical",divider:!0,disabled:!0},"Cyclical"),P.Cyclical.map((function(t){return r.a.createElement($e.a,{value:t,key:t},r.a.createElement(St,{width:200,label:!1,height:20,scale:e.getScale(t)}))})))}}]),t}(r.a.PureComponent),ya=nt()((function(e){return{root:{display:"flex",flexWrap:"wrap","flex-direction":"column"},formControl:{display:"block",margin:e.spacing(1),minWidth:200},select:{minWidth:200}}}))(Object(i.b)((function(e){return{interpolator:e.interpolator}}),(function(e){return{handleInterpolator:function(t){e({type:Q,payload:t})}}}))(ga)),va=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(g.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).onMarkerSizeChange=function(e){a.props.handleMarkerSizeUI(e.target.value)},a.onMarkerSizeKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);t>0&&a.props.handleMarkerSize(t)}},a.onEmbeddingChartSizeChange=function(e){a.props.handleEmbeddingChartSize(e.target.value)},a.onMarkerSizeKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);t>0&&a.props.handleMarkerSize(t)}},a.onUnselectedMarkerSizeChange=function(e){a.props.handleUnselectedMarkerSizeUI(e.target.value)},a.onUnselectedMarkerSizeKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);t>0&&a.props.handleUnselectedMarkerSize(t)}},a.onMarkerOpacityChange=function(e){a.props.handleMarkerOpacityUI(e.target.value)},a.onMarkerOpacityKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);t>0&&t<=1&&a.props.handleMarkerOpacity(t)}},a.onUnselectedMarkerOpacityChange=function(e){a.props.handleUnselectedMarkerOpacityUI(e.target.value)},a.onUnselectedMarkerOpacityKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);t>0&&t<=1&&a.props.handleUnselectedMarkerOpacity(t)}},a.onNumberOfBinsChange=function(e){a.props.handleNumberOfBinsUI(e.target.value)},a.onNumberOfBinsKeyPress=function(e){if("Enter"===e.key){var t=parseInt(e.target.value);t>0&&a.props.handleNumberOfBins(t)}},a.onBinSummaryChange=function(e){a.props.handleBinSummary(e.target.value)},a.handleBinValuesChange=function(e){a.props.handleBinValues(e.target.checked)},a.handleViewChange=function(e){a.props.handleViewName(e.target.value)},a}return Object(v.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.embeddingChartSize,n=e.unselectedMarkerSize,l=e.selectedFeatures,i=e.selectedGroupBy,o=e.selectedEmbeddings,s=e.numberOfBins,c=e.markerSize,u=e.markerOpacity,d=e.unselectedMarkerOpacity,p=e.binValues,h=e.binSummary,m=e.dataset,f=null==m?[]:m.features,g=null==m?[]:m.embeddings,y=null==m?[]:m.obsCat,v=null==m?[]:m.obs,b=l.concat(i);b=b.map((function(e){return{label:e,value:e}}));var E=v.map((function(e){return{label:e,value:e}}));(E=E.concat(y.map((function(e){return{label:e,value:e,categorical:!0}})))).sort((function(e,t){return(e=e.label.toLowerCase())<(t=t.label.toLowerCase())?-1:e==t?0:1}));var O=[{label:"Annotations",options:E},{label:"Variables",options:f.map((function(e){return{label:e,value:e}}))}],k=[{label:"Annotations",options:E},{label:"Variables",options:[{isDisabled:!0,label:"Type to search",value:""}]}];return r.a.createElement("div",{className:t.root},r.a.createElement(Kt.a,{className:t.formControl},r.a.createElement(qt.a,{htmlFor:"view"},"Embedding"),r.a.createElement(tt.a,{className:t.select,input:r.a.createElement(Ze.a,{id:"view"}),onChange:this.handleViewChange,value:0===o.length?"":o[0],multiple:!1},g.map((function(e){return r.a.createElement($e.a,{key:e.name,value:e.name},r.a.createElement(Yt.a,{primary:e.name}))})))),r.a.createElement(Kt.a,{className:t.formControl},r.a.createElement(fa,{label:"Features",options:O,defaultOptions:k,value:b,onChange:this.props.handleFeatures,isMulti:!0})),r.a.createElement(Kt.a,{className:t.formControl},r.a.createElement(qt.a,{htmlFor:"chart_size"},"Chart Size"),r.a.createElement(tt.a,{className:t.select,input:r.a.createElement(Ze.a,{id:"chart_size"}),onChange:this.onEmbeddingChartSizeChange,value:a,multiple:!1},[{label:"Small",value:3},{label:"Medium",value:2},{label:"Large",value:1}].map((function(e){return r.a.createElement($e.a,{key:e.label,value:e.value},r.a.createElement(Yt.a,{primary:e.label}))})))),r.a.createElement(Mt.a,{type:"number",step:"2",min:"0",max:"30",onKeyPress:this.onMarkerSizeKeyPress,onChange:this.onMarkerSizeChange,label:"Marker Size",className:t.formControl,value:c}),r.a.createElement(Mt.a,{step:"0.1",type:"number",min:"0",max:"1",onKeyPress:this.onMarkerOpacityKeyPress,onChange:this.onMarkerOpacityChange,label:"Marker Opacity",className:t.formControl,value:u}),r.a.createElement(Wt.a,{control:r.a.createElement(Ft.a,{checked:p,value:"binPlot",onChange:this.handleBinValuesChange}),label:"Bin Plot"}),r.a.createElement(Kt.a,{className:t.formControl},r.a.createElement(qt.a,{htmlFor:"color-scheme"},"Color Scheme"),r.a.createElement(ya,null)),p&&r.a.createElement(Mt.a,{max:"1000",min:"20",step:"100",onKeyPress:this.onNumberOfBinsKeyPress,value:s,onChange:this.onNumberOfBinsChange,label:"# Bins Per Axis",className:t.formControl}),p&&r.a.createElement(Kt.a,{className:t.formControl},r.a.createElement(qt.a,{htmlFor:"summary"},"Bin Summary"),r.a.createElement(tt.a,{className:t.select,input:r.a.createElement(Ze.a,{id:"summary"}),onChange:this.onBinSummaryChange,value:h},[{value:"min",label:"Minimum"},{value:"max",label:"Maximum"},{value:"mean",label:"Mean"},{value:"sum",label:"Sum"}].map((function(e){return r.a.createElement($e.a,{key:e.value,value:e.value},r.a.createElement(Yt.a,{primary:e.label}))})))),r.a.createElement(Gt.a,null),r.a.createElement(Xt.a,{color:"textSecondary",display:"block",variant:"caption"},"Unselected Chart Properties"),r.a.createElement(Mt.a,{type:"number",step:"2",min:"0",max:"30",onKeyPress:this.onUnselectedMarkerSizeKeyPress,onChange:this.onUnselectedMarkerSizeChange,label:"Unselected Marker Size",className:t.formControl,value:n}),r.a.createElement(Mt.a,{step:"0.1",type:"number",min:"0",max:"1",onKeyPress:this.onUnselectedMarkerOpacityKeyPress,onChange:this.onUnselectedMarkerOpacityChange,label:"Unselected Marker Opacity",className:t.formControl,value:d}))}}]),t}(r.a.PureComponent),ba=nt()((function(e){return{root:{display:"flex",flexWrap:"wrap","flex-direction":"column"},formControl:{display:"block",margin:e.spacing(1),minWidth:200},select:{minWidth:200}}}))(Object(i.b)((function(e){return{selectedFeatures:e.features,selectedGroupBy:e.groupBy,selectedEmbeddings:e.embeddings,numberOfBins:e.numberOfBinsUI,markerSize:e.markerSizeUI,unselectedMarkerSize:e.unselectedMarkerSizeUI,markerOpacity:e.markerOpacityUI,embeddingChartSize:e.embeddingChartSize,unselectedMarkerOpacity:e.unselectedMarkerOpacityUI,binValues:e.binValues,binSummary:e.binSummary,dataset:e.dataset}}),(function(e,t){return{handleNumberOfBins:function(t){var a;e((a=t,function(e,t){if(t().numberOfBins!==a){var n=t().numberOfBins;e({type:Y,payload:a}),e(Ne({embedding:!0,clear:!0},(function(t){e({type:Y,payload:n})})))}}))},handleNumberOfBinsUI:function(t){e({type:pe,payload:t})},handleMarkerSize:function(t){e({type:R,payload:t})},handleMarkerSizeUI:function(t){e({type:he,payload:t})},handleUnselectedMarkerSize:function(t){e({type:T,payload:t})},handleUnselectedMarkerSizeUI:function(t){e({type:_,payload:t})},handleMarkerOpacity:function(t){e({type:V,payload:t})},handleMarkerOpacityUI:function(t){e({type:me,payload:t})},handleUnselectedMarkerOpacity:function(t){e({type:F,payload:t})},handleEmbeddingChartSize:function(t){e({type:H,payload:t})},handleUnselectedMarkerOpacityUI:function(t){e({type:fe,payload:t})},handleBinSummary:function(t){var a;e((a=t,function(e,t){var n=t().binSummary;e({type:J,payload:a}),e(Ne({embedding:!0,clear:!0},(function(t){e({type:J,payload:n})})))}))},handleBinValues:function(t){var a;e((a=t,function(e,t){var n=t().binValues;e({type:X,payload:a}),e(Ne({embedding:!0,clear:!0},(function(t){e({type:X,payload:n})})))}))},handleViewName:function(t){e(Ue(null==t?[]:[t]))},handleFeatures:function(t){e(Be(null==t?[]:t))}}}))(va)),Ea=5,Oa=1,ka=.1,Sa="mean",Ca=500,wa="Viridis",ja={name:wa,value:x(wa)};var Pa=Object(o.c)({binSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Sa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case J:return t.payload;case te:return Sa;case oe:return null!=t.payload.binSummary?t.payload.binSummary:e;default:return e}},binValues:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case X:return t.payload;case te:return!1;case oe:return null!=t.payload.binValues?t.payload.binValues:e;default:return e}},categoricalFilter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case U:return t.payload;case oe:return null!=t.payload.categoricalFilter?t.payload.categoricalFilter:e;default:return e}},dataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case te:return t.payload;default:return e}},datasetChoices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ie:return t.payload;case $:return null==t.payload?[]:e;case I:return(e=e.concat([t.payload])).sort((function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:1})),e;case L:case N:for(var a=-1,n=0;n<e.length;n++)if(e[n].id===t.payload.id){a=n;break}return-1!==a?(t.type===L?e[a]=t.payload:e.splice(a,1),e.slice()):e;default:return e}},dialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ae:return t.payload;default:return e}},dotPlotData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case se:return t.payload;case te:return null;default:return e}},email:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case $:return t.payload;default:return e}},embeddingChartSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case H:return t.payload;case oe:return null!=t.payload.embeddingChartSize?t.payload.embeddingChartSize:e;default:return e}},embeddingData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ce:return t.payload;case H:var a=z.getEmbeddingChartSize(t.payload);return e.forEach((function(e){var t=Object.assign({},e.layout);t.width=a,t.height=a,e.layout=t})),e.slice();case R:return e.forEach((function(e){e.data.forEach((function(e){e.marker.size=t.payload})),e.data=e.data.slice()})),e.slice();case G:var n=t.payload.indices;return null!=t.payload.bins&&(n=z.convertBinsToPoints(e[0].data[0].bins,t.payload.bins)),e.forEach((function(e){e.data.forEach((function(e){e.selectedpoints=n})),e.data=e.data.slice()})),e.slice();case Q:var r=Object(u.a)().domain([0,255]).range([0,1]);return e.forEach((function(e){if(e.continuous){var a=Object(d.a)(t.payload.value).domain(e.colorScale.domain());e.data.forEach((function(e){for(var t=[],n=0,l=e.values.length;n<l;n++){var i=Object(c.e)(a(e.values[n]));t.push([r(i.r),r(i.g),r(i.b)])}e.marker.color=t})),e.colorScale=a}e.data=e.data.slice()})),e.slice();case V:return e.forEach((function(e){e.data.forEach((function(e){e.marker.opacity=t.payload})),e.data=e.data.slice()})),e.slice();case F:return e.forEach((function(e){e.data.forEach((function(e){e.unselected.marker.opacity=t.payload})),e.data=e.data.slice()})),e.slice();case T:return e.forEach((function(e){e.data.forEach((function(e){e.unselected.marker.size=t.payload})),e.data=e.data.slice()})),e.slice();case te:return[];default:return e}},embeddings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case q:return t.payload;case te:return[];case oe:return null!=t.payload.embeddings?t.payload.embeddings:e;default:return e}},features:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case K:return t.payload;case te:return[];case oe:return t.payload.features||[];default:return e}},groupBy:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case W:return t.payload;case te:return[];case oe:return t.payload.groupBy||[];default:return e}},interpolator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ja,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Q:return t.payload;case oe:return null!=t.payload.colorScheme?t.payload.colorScheme:e;default:return e}},loading:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ue:return t.payload;default:return e}},loadingApp:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case de:return t.payload;default:return e}},markerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Oa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case V:return t.payload;case te:return Oa;case oe:return null!=t.payload.markerOpacity?t.payload.markerOpacity:e;default:return e}},markerOpacityUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case V:case me:return t.payload;case te:return Oa;case oe:return null!=t.payload.markerOpacity?t.payload.markerOpacity:e;default:return e}},markerSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ea,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:return t.payload;case te:return Ea;case oe:return null!=t.payload.markerSize?t.payload.markerSize:e;default:return e}},markerSizeUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:case he:return t.payload;case te:return Ea;case oe:return null!=t.payload.markerSize?t.payload.markerSize:e;default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Z:return t.payload;default:return e}},numberOfBins:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ca,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Y:return t.payload;case te:return Ca;case oe:return null!=t.payload.numberOfBins?t.payload.numberOfBins:e;default:return e}},numberOfBinsUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ca,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Y:case pe:return t.payload;case te:return Ca;case oe:return null!=t.payload.numberOfBins?t.payload.numberOfBins:e;default:return e}},plotConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch((arguments.length>1?arguments[1]:void 0).type){case te:return z.createPlotConfig();default:return e}},selectedValueCounts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case G:return t.payload;case te:return{};default:return e}},serverInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case B:return t.payload;default:return e}},unselectedMarkerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ka,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return t.payload;case te:return ka;case oe:return null!=t.payload.unselectedMarkerOpacity?t.payload.unselectedMarkerOpacity:e;default:return e}},unselectedMarkerOpacityUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ka,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:case fe:return t.payload;case te:return ka;case oe:return null!=t.payload.unselectedMarkerOpacity?t.payload.unselectedMarkerOpacity:e;default:return e}},unselectedMarkerSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ea,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:return t.payload;case te:return Ea;case oe:return null!=t.payload.unselectedMarkerSize?t.payload.unselectedMarkerSize:e;default:return e}},unselectedMarkerSizeUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:case _:return t.payload;case te:return Ea;case oe:return null!=t.payload.unselectedMarkerSize?t.payload.unselectedMarkerSize:e;default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ee:return t.payload;default:return e}}}),Ma=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(g.a)(this,Object(y.a)(t).call(this,e))).handleUserMenuClose=function(){a.setState({userMenuOpen:!1})},a.handleMessageClose=function(){a.props.setMessage(null)},a.handleUserMenuOpen=function(e){a.setState({userMenuOpen:!0,userMenuAnchorEl:e.currentTarget})},a.handleLinkMenuClose=function(e){a.setState({linkMenuOpen:!1,linkMenuAnchorEl:null})},a.copyLink=function(){a.linkRef.current.focus(),a.linkRef.current.select(),document.execCommand("copy"),a.props.setMessage("Link copied")},a.handleSelectedCellsClick=function(e){e.preventDefault(),a.props.downloadSelectedIds()},a.handleLinkMenuOpen=function(e){var t=window.location.protocol+"//"+window.location.host,n={dataset:a.props.dataset.id,embedding:a.props.embedding};a.props.features.length>0&&(n.features=a.props.features),a.props.groupBy.length>0&&(n.groupBy=a.props.groupBy);var r=a.props.categoricalFilter;Object.keys(r).length>0&&(n.categoricalFilter=a.props.categoricalFilter),a.props.markerSize!==Ea&&(n.markerSize=a.props.markerSize),a.props.markerOpacity!==Oa&&(n.markerOpacity=a.props.markerOpacity),a.props.binValues&&(n.binValues=!0,a.props.binSummary!==Sa&&(n.binSummary=a.props.binSummary),a.props.numberOfBins!==Ca&&(n.numberOfBins=a.props.numberOfBins)),a.props.view3d&&(n["3d"]=!0),a.props.interpolator.name!==wa&&(n.colorScheme=a.props.interpolator.name),t+="?q="+JSON.stringify(n),a.setState({linkMenuOpen:!0,linkMenuAnchorEl:e.currentTarget,linkText:t})},a.handleLogout=function(){a.setState({userMenuOpen:!1}),a.props.handleLogout()},a.handleDataset=function(e){"importDataset"===e.target.value?a.props.handleDialog(re):a.props.handleDataset(e.target.value)},a.handleSettings=function(e){a.props.handleDialog(ne)},a.handleDelete=function(e){a.props.handleDialog(le)},a.state={userMenuOpen:!1,linkMenuOpen:!1,userMenuAnchorEl:null,linkMenuAnchorEl:null,linkText:null},a.linkRef=r.a.createRef(),a}return Object(v.a)(t,e),Object(O.a)(t,[{key:"componentDidUpdate",value:function(e,t,a){var n=this;this.state.linkMenuOpen&&window.requestAnimationFrame((function(){n.linkRef.current.focus(),n.linkRef.current.select()}))}},{key:"render",value:function(){var e=this.props.classes,t=null!=this.props.dataset&&this.props.dataset.nObs>0&&!isNaN(this.props.selectedValueCounts.count),a=!t&&null!=this.props.dataset&&!(this.props.selectedValueCounts.count>0)&&this.props.dataset.nObs>0;return r.a.createElement("div",{className:e.root},(this.props.dialog===ne||this.props.dialog===re)&&r.a.createElement(zt,null),this.props.dialog===le&&r.a.createElement(Et,null),r.a.createElement(Ke.a,{position:"fixed",color:"default",className:e.appBar},r.a.createElement(rt.a,{variant:"dense"},r.a.createElement("div",null,r.a.createElement(ut.a,{style:{verticalAlign:"bottom"},fontSize:"large"}),r.a.createElement("h3",{style:{display:"inline",marginRight:20}},"Cirro"),this.props.loadingApp&&r.a.createElement("span",null,"Loading..."),null!=this.props.email&&r.a.createElement(tt.a,{disableUnderline:!0,displayEmpty:!0,value:null==this.props.dataset?"":this.props.dataset.id,onChange:this.handleDataset,inputProps:{name:"dataset",id:"dataset-id"}}," ",this.props.datasetChoices.length>0&&r.a.createElement($e.a,{key:"",value:"",disabled:!0},"Choose a dataset"),this.props.datasetChoices.map((function(e){return r.a.createElement($e.a,{key:e.id,value:e.id},e.name)})),this.props.user.importer&&this.props.datasetChoices.length>0&&r.a.createElement("hr",null),this.props.user.importer&&r.a.createElement($e.a,{key:"importDataset",value:"importDataset"},"Import...")),r.a.createElement("div",{style:{display:"inline-block",marginLeft:"10px"}},t&&r.a.createElement(Qe.a,{title:"Download selected ids",href:"#",onClick:this.handleSelectedCellsClick},w(this.props.selectedValueCounts.count)),t&&" / "+w(this.props.dataset.nObs)+" cells",a&&w(this.props.dataset.nObs)+" cells")),r.a.createElement("div",{style:{marginLeft:"auto"}},null!=this.props.dataset&&r.a.createElement(Ve.a,{title:"Link"},r.a.createElement(He.a,{"aria-owns":this.state.linkMenuOpen?"link-popper":void 0,"aria-haspopup":"true",onClick:this.handleLinkMenuOpen,"aria-label":"Link"},r.a.createElement(mt.a,null))),null!==this.props.dataset&&this.props.dataset.owner&&r.a.createElement(Ve.a,{title:"Edit"},r.a.createElement(He.a,{onClick:this.handleSettings,"aria-label":"Edit"},r.a.createElement(gt.a,null))),null!==this.props.dataset&&this.props.dataset.owner&&r.a.createElement(Ve.a,{title:"Delete"},r.a.createElement(He.a,{onClick:this.handleDelete,"aria-label":"Delete"},r.a.createElement(pt.a,null))),null!=this.props.dataset&&r.a.createElement(et.a,{id:"link-popper",open:this.state.linkMenuOpen,anchorEl:this.state.linkMenuAnchorEl,onClose:this.handleLinkMenuClose,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},r.a.createElement("div",{style:{padding:10}},r.a.createElement("h4",null,"Copy link to share your current view"),r.a.createElement(We.a,{size:"small",variant:"outlined",onClick:this.copyLink},"Copy")," ",r.a.createElement(Ze.a,{autoFocus:!0,inputRef:this.linkRef,readOnly:!0,value:this.state.linkText}))),null!=this.props.email&&r.a.createElement(Ve.a,{title:this.props.email},r.a.createElement(He.a,{style:{marginLeft:50},"aria-label":"Menu","aria-haspopup":"true",onClick:this.handleUserMenuOpen},r.a.createElement(it.a,null))),null!=this.props.email&&r.a.createElement(Fe.a,{id:"menu-user",anchorEl:this.state.userMenuAnchorEl,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.userMenuOpen,onClose:this.handleUserMenuClose},r.a.createElement($e.a,{onClick:this.handleLogout},"Sign Out")),!this.props.loadingApp&&null==this.props.email&&r.a.createElement(We.a,{style:{whiteSpace:"nowrap"},variant:"outlined",color:"primary",onClick:this.props.handleLogin},"Sign In")))),r.a.createElement(Je.a,{className:e.drawer,variant:"permanent",classes:{paper:e.drawerPaper},anchor:"left"},null!=this.props.dataset&&r.a.createElement(ba,{key:this.props.dataset.id})),r.a.createElement("div",null),r.a.createElement("main",{className:e.content},null!=this.props.dataset&&r.a.createElement(Ht,null),null!=this.props.dataset&&r.a.createElement(Pt,null)),this.props.loading&&r.a.createElement(Ye.a,{"aria-labelledby":"loading-dialog-title",open:!0},r.a.createElement(Xe.a,{id:"loading-dialog-title"},r.a.createElement(qe.a,{size:20})," Loading...")),null!=this.props.message&&r.a.createElement(Ge.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},ContentProps:{"aria-describedby":"message-id"},onClose:this.handleMessageClose,open:!0,autoHideDuration:6e3,action:[r.a.createElement(He.a,{key:"close","aria-label":"Close",color:"inherit",onClick:this.handleMessageClose},r.a.createElement(st.a,null))],message:r.a.createElement("span",{id:"message-id"},this.props.message instanceof Error?this.props.message.message:this.props.message)}))}}]),t}(n.PureComponent),xa=nt()((function(e){return{root:{display:"flex"},appBar:{width:"calc(100% - ".concat(240,"px)"),marginLeft:240},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},toolbar:e.mixins.toolbar,content:{flexGrow:1,backgroundColor:e.palette.background.default,paddingTop:e.spacing(6.5),paddingLeft:e.spacing(1)}}}))(Object(i.b)((function(e){return{binSummary:e.binSummary,binValues:e.binValues,categoricalFilter:e.categoricalFilter,dataset:e.dataset,datasetChoices:e.datasetChoices,dialog:e.dialog,email:e.email,embedding:e.embedding,features:e.features,groupBy:e.groupBy,interpolator:e.interpolator,loading:e.loading,loadingApp:e.loadingApp,markerOpacity:e.markerOpacity,markerSize:e.markerSize,message:e.message,numberOfBins:e.numberOfBins,selectedValueCounts:e.selectedValueCounts,user:e.user,view3d:e.view3d}}),(function(e){return{handleLogin:function(){e((function(e,t){window.gapi.auth2.getAuthInstance().signIn().then((function(t){e(we())}))}))},handleLogout:function(){e(be())},handleDataset:function(t){e(Ie(t))},handleDialog:function(t){e(ze(t))},setMessage:function(t){e(xe(t))},downloadSelectedIds:function(){e((function(e,t){e(Ae(!0));var a=Ee(t());fetch(A+"/selected_ids",{body:JSON.stringify(a),method:"POST",headers:{Authorization:"Bearer "+je()}}).then((function(e){return e.json()})).then((function(e){var t=new Blob([e.join("\n")],{type:"text/plain;charset=utf-8"});Object(m.saveAs)(t,"selection.txt")})).finally((function(){e(Ae(!1))}))}))}}}))(Ma)),za=a(236),Aa=a(127),Da=Object(Aa.a)({palette:{type:"light"}}),Ta=Object(o.d)(Pa,Object(o.a)(s.a));Ta.dispatch((function(e,t){fetch(A+"/server").then((function(e){return e.json()})).then((function(t){if(""==t.clientId)e(De(!1)),e(_e("")),e(Re()).then((function(){e(Ce()),e((function(e,t){null==t().dataset&&1===t().datasetChoices.length&&e(Ie(t().datasetChoices[0].id))}))}));else{var a=document.createElement("script");a.type="text/javascript",a.src="https://apis.google.com/js/api.js",e({type:B,payload:t}),a.onload=function(a){window.gapi.load("client:auth2",(function(){window.gapi.client.init({clientId:t.clientId,discoveryDocs:[],scope:D.join(" ")}).then((function(){e(De(!1)),e(we(!0))}))}))},document.getElementsByTagName("head")[0].appendChild(a)}}))})),Object(l.render)(r.a.createElement(i.a,{store:Ta},r.a.createElement(za.a,{theme:Da},r.a.createElement(xa,null))),document.getElementById("root"))}},[[151,1,2]]]);
//# sourceMappingURL=main.f767122b.chunk.js.map
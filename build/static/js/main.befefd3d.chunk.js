(window.webpackJsonpcirrocumulus=window.webpackJsonpcirrocumulus||[]).push([[0],{146:function(e,t,a){e.exports=a(172)},172:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(12),l=a(27),o=a(47),s=a(108),c=a(31),u=a(59),d=a(230),p=a(209),h=a(104),m=a(14),f=a(18),g=a(15),y=a(16),v=a(121),b=function(e){function t(){var e;Object(m.a)(this,t);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(n)))}return Object(y.a)(t,e),t}(Object(v.a)(Error)),E=a(17),O=a(20),k=a(65),S={Diverging:["interpolateBrBG","interpolatePRGn","interpolatePiYG","interpolatePuOr","interpolateRdBu","interpolateRdGy","interpolateRdYlBu","interpolateRdYlGn","interpolateSpectral"],"Sequential (Single Hue)":["interpolateBlues","interpolateGreens","interpolateGreys","interpolateOranges","interpolatePurples","interpolateReds"],"Sequential (Multi-Hue)":["interpolateViridis","interpolateInferno","interpolateMagma","interpolatePlasma","interpolateWarm","interpolateCool","interpolateCubehelixDefault","interpolateBuGn","interpolateBuPu","interpolateGnBu","interpolateOrRd","interpolatePuBuGn","interpolatePuBu","interpolatePuRd","interpolateRdPu","interpolateYlGnBu","interpolateYlGn","interpolateYlOrBr","interpolateYlOrRd"],Cyclical:["interpolateRainbow","interpolateSinebow"]},C=Object(O.a)(","),w=Object(O.a)(".1f");function M(e,t,a,n){var r=null,i=null;if(null!=e){var l=t.valueCounts.values[n],o=(e[l]||0)/t.valueCounts.counts[n];i=a(o),r=C(e[l]||0)+" / "+C(t.valueCounts.counts[n])+" ("+w(100*o)+"%)"}else i=a(t.valueCounts.counts[n]),r=C(t.valueCounts.counts[n]);return{width:i,text:r}}function j(e,t,a){var n=[Number.MAX_VALUE,-Number.MAX_VALUE];return t.forEach((function(t,r){var i;null!=e?i=e[t]/a[r]:i=a[r];n[0]=Math.min(n[0],i),n[1]=Math.max(n[1],i)})),Object(u.a)().domain(n).range([10,60])}function P(e){return e.startsWith("interpolate")||(e="interpolate"+e),k[e]}var A=function(){function e(){Object(m.a)(this,e)}return Object(E.a)(e,null,[{key:"createPlotConfig",value:function(){return{showLink:!0,responsive:!0,displaylogo:!1,modeBarButtonsToRemove:["hoverCompareCartesian","hoverClosestCartesian","toggleSpikelines"]}}},{key:"fixLegend",value:function(e){requestAnimationFrame((function(){if(e){var t=e.querySelectorAll(".scatterpts");t&&t.forEach((function(e){e.setAttribute("d","M6,0A6,6 0 1,1 0,-6A6,6 0 0,1 6,0Z"),e.style.opacity=1}))}}))}},{key:"createAxis",value:function(e){return e.embedding?{showbackground:!1,autorange:!0,showgrid:!1,zeroline:!1,showline:!1,autotick:!1,ticks:"",showticklabels:!1,title:""}:{showbackground:!1,autorange:!0,showgrid:!1,zeroline:!1,showline:!1,title:""}}},{key:"createPlotLayout",value:function(t){var a=t.legend||0,n=Math.floor(Math.min(window.screen.availWidth-220,.95*window.screen.availHeight)),r={hovermode:"closest",dragmode:"select",title:{text:t.title,font:{size:12}},width:n+a,height:n,margin:{l:t.embedding?0:50,b:t.embedding?0:50,r:a+(t.embedding?0:100),t:t.title?22:0,autoexpand:!0},legend:{yanchor:"top"},autosize:!t.embedding,displaylogo:!1,showlegend:t.legend>0};return t.is3d?r.scene={xaxis:e.createAxis(t),yaxis:e.createAxis(t),zaxis:e.createAxis(t)}:(r.xaxis=e.createAxis(t),r.yaxis=e.createAxis(t)),r}}]),e}(),x="/api",_=["email","profile","https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/contacts.readonly","https://www.googleapis.com/auth/devstorage.full_control"],D="SET_UNSELECTED_MARKER_SIZE",T="SET_UNSELECTED_MARKER_SIZE_UI",B="SET_SERVER_INFO",U="SET_LEGEND_VISIBILITY",I="ADD_DATASET",L="DELETE_DATASET",N="UPDATE_DATASET",z="SET_MARKER_SIZE",V="SET_MARKER_OPACITY",R="SET_UNSELECTED_MARKER_OPACITY",G="SET_SELECTED_VALUE_COUNTS",F="SET_FEATURES",W="SET_GROUP_BY",K="SET_SELECTED_EMBEDDING",q="SET_NUMBER_OF_BINS",H="SET_BIN_VALUES",Y="SET_BIN_SUMMARY",X="SET_MESSAGE",J="SET_INTERPOLATOR",Z="SET_EMAIL",Q="SET_USER",$="SET_DATASET",ee="SET_DIALOG",te="EDIT_DATASET_DIALOG",ae="IMPORT_DATASET_DIALOG",ne="DELETE_DATASET_DIALOG",re="SET_DATASET_CHOICES",ie="RESTORE_VIEW",le="SET_DOT_PLOT_DATA",oe="SET_EMBEDDING_DATA",se="SET_LOADING",ce="LOADING_APP",ue="SET_NUMBER_OF_BINS_UI",de="SET_MARKER_SIZE_UI",pe="SET_MARKER_OPACITY_UI",he="SET_UNSELECTED_MARKER_OPACITY_UI",me=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],fe=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];function ge(){return function(e,t){fetch(x+"/user",{headers:{Authorization:"Bearer "+Se(),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){return e({type:Q,payload:t})}))}}function ye(){return function(e,t){window.gapi.auth2.getAuthInstance().signOut().then((function(){e({type:Z,payload:null}),e(xe(null))}))}}function ve(e,t,a,n){var r,i=n().dataset.id,l=n().features,o=n().groupBy,s={id:i,embedding:n().embeddings[0],keys:l.concat(o)};return n().binValues&&(s.nbins=n().numberOfBins),e.length>0&&(s.p=e),Object.keys(t).length>0&&(s.c=t),(r=fetch(x+"/selected_value_counts",{body:JSON.stringify(s),method:"POST",headers:{Authorization:"Bearer "+Se()}})).then((function(e){return e.json()})).then((function(e){return a({type:G,payload:e})})),r}function be(e){return function(t,a){var n=e.name,r=e.value,i=a().legendVisibility,l=i[n];null==l&&(l=[],i[n]=l);var o=l.indexOf(r);-1!==o?l.splice(o,1):l.push(r),0===Object.keys(i).length&&delete i[n],console.log(i),t(function(e){return{type:U,payload:e}}(i)),ve([],i,t,a)}}function Ee(e){var t=null==e?[]:e.points[0].data.selectedpoints;return function(e,a){ve(t,a().legendVisibility,e,a)}}function Oe(){return function(e,t){var a=window.location.search.substring(3);if(0!==a.length){var n;try{n=JSON.parse(window.decodeURIComponent(a))}catch(i){return e(Me("Unable to restore saved view."))}if(null!=n.dataset){if(null!=n.colorScheme){var r=P(n.colorScheme);null!=r&&(n.colorScheme={name:n.colorScheme,value:r})}e(Be(n.dataset)).then((function(){return e({type:ie,payload:n})})).then((function(){return e(Ue({embedding:!0,dotPlot:!0,clear:!0}))})).catch((function(t){console.log(t),e(Me("Unable to restore saved view."))}))}}}}function ke(e){return function(t,a){if(window.gapi.auth2.getAuthInstance().isSignedIn.get()){var n=window.gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getEmail();t(_e(n)),t(ge()),t(Le()).then((function(){e&&t(Oe())}))}}}function Se(){return"undefined"!==typeof window.gapi?window.gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token:""}function Ce(e){return function(t,a){var n=e.readers,r=e.name,i=e.url;if(""!=r&&""!==i){i.substring("gs://".length).indexOf("/");var l=null!=e.dataset;t(Pe(!0));var o=a().serverInfo.email,s=!l||i!==e.dataset.url;Promise.resolve({ok:!0}).then((function(e){})).then((function(){return fetch(x+"/dataset",{body:JSON.stringify({id:null!=e.dataset?e.dataset.id:null,url:i,name:r,readers:n}),method:l?"PUT":"POST",headers:{Authorization:"Bearer "+Se()}})})).then((function(e){return e.json()})).then((function(e){l?(t(function(e){return{type:N,payload:e}}({name:r,id:e.id,owner:!0})),t(Me(s?"Please ensure that "+o+' is a "Storage Object Viewer"':"Dataset updated"))):(t(function(e){return{type:I,payload:e}}({name:r,id:e.id,owner:!0})),t(Me(s?"Please ensure that "+o+' is a "Storage Object Viewer"':"Dataset created")))})).finally((function(){t(Pe(!1)),t(je(null))})).catch((function(e){Ie(t,e)}))}}}function we(e){return function(t,a){t(Pe(!0)),fetch(x+"/dataset",{body:JSON.stringify({id:e.dataset.id}),method:"DELETE",headers:{Authorization:"Bearer "+Se()}}).then((function(){t(function(e){return{type:L,payload:e}}({id:e.dataset.id})),t(Me("Dataset deleted"))})).finally((function(){t(Pe(!1)),t(je(null))})).catch((function(e){Ie(t,e,"Unable to delete dataset. Please try again.")}))}}function Me(e){return{type:X,payload:e}}function je(e){return{type:ee,payload:e}}function Pe(e){return{type:se,payload:e}}function Ae(e){return{type:ce,payload:e}}function xe(e){return{type:$,payload:e}}function _e(e){return{type:Z,payload:e}}function De(e){var t=e;return function(e,a){var n=a(),r=n.dataset.obsCat,i=n.features,l=n.groupBy,o=[],s=[];t.forEach((function(e){-1!==r.indexOf(e)?s.push(e):o.push(e)})),o.length!==i.length&&e(function(e){return function(t,a){var n=a().features;t({type:F,payload:e}),t(Ue({embedding:!0,dotPlot:!0},(function(e){t({type:F,payload:n})})))}}(o)),s.length!==l.length&&e(function(e){return function(t,a){var n=a().groupBy,r=a().legendVisibility,i=!1;for(var l in r)-1===e.indexOf(l)&&(delete r[l],i=!0);i&&t({type:U,payload:r}),t({type:W,payload:e}),t(Ue({embedding:!0,dotPlot:!0},(function(e){t({type:W,payload:n})})))}}(s))}}function Te(e){return function(t,a){var n=a().embeddings;t({type:K,payload:e}),t(Ue({embedding:!0,clear:!0},(function(e){t({type:K,payload:n})})))}}function Be(e){return function(t,a){for(var n=a().datasetChoices,r=null,i=0;i<n.length;i++)if(n[i].id===e){r=n[i];break}if(null!=r)return t(xe({owner:r.owner,name:r.name,id:e,embeddings:[],features:[],obs:[],obsCat:[]})),t(Pe(!0)),fetch([x+"/schema?id="+e].join(""),{headers:{Authorization:"Bearer "+Se()}}).then((function(e){return e.json()})).then((function(a){var n;return"1"===a.version&&(n={owner:r.owner,name:r.name,id:e,embeddings:a.embeddings,features:a.var,obsCat:a.obs_cat,nObs:a.n_obs,obs:a.obs}),t(xe(n)),t((function(e,t){var a=t().dataset.embeddings.map((function(e){return e.name})),n={X_fle:1,X_umap:2,X_tsne:3,X_fitsne:4};a.sort((function(e,t){return(e=n[e]||Number.MAX_VALUE)-(t=n[t]||Number.MAX_VALUE)})),a.length>0&&e(Te([a[0]]))})),n})).finally((function(){t(Pe(!1))})).catch((function(e){Ie(t,e,"Unable to retrieve dataset. Please try again.")}));t(Me("Unable to find dataset"))}}function Ue(e,t){return function(a,n){var r=n().features,i=n().groupBy;if(null!=n().dataset){a(Pe(!0));var l=n().dataset.id,o=n().dataset.obs,s=n().embeddings;e.embedding&&0===s.length&&(e.embedding=!1),e.dotPlot&&0===r.length&&(e.dotPlot=!1);var m=n().embeddingData;e.clear&&(m=[]);var f={},g=r.concat(i),y=[],v=n().markerSize,b=n().markerOpacity,E=n().unselectedMarkerSize,O=n().unselectedMarkerOpacity;m.forEach((function(e){f[e.name]=!0;var t=-1!==g.indexOf(e.name);t&&(e.date=new Date,e.layout=A.createPlotLayout({embedding:!0,is3d:s[0].endsWith("3d"),legend:!1,title:e.name})),e.active=t}));var k=[x+"/slice?id="+l],S=[x+"/slice?id="+l],C=0;r.forEach((function(e){-1===o.indexOf(e)&&(S.push("&key="+e),C++),null!=f[e]||(y.push(e),k.push("&key="+e))})),(e.embedding||e.dotPlot)&&i.forEach((function(e){S.push("&key="+e),null!=f[e]||(y.push(e),k.push("&key="+e))}));var w=n().numberOfBins>0&&n().binValues;e.embedding&&w&&(k.push("&nbins="+n().numberOfBins),k.push("&reduce_function="+n().binSummary)),e.embedding&&s.length>0&&s.forEach((function(e){return k.push("&embedding="+e)}));var M=n().interpolator,j=n().selectedValueCounts,P=[];if(e.dotPlot){var _=null;_=C>0&&i.length>0?fetch(S.join(""),{headers:{Authorization:"Bearer "+Se()}}).then((function(e){return e.json()})):Promise.resolve({stats:{}}),P.push(_),_.then((function(e){var t;a((t=e.dotplot||null,{type:le,payload:t}))}))}if(e.embedding){var D=ve([],n().legendVisibility,a,n),T=fetch(k.join(""),{headers:{Authorization:"Bearer "+Se()}}).then((function(e){return e.json()}));P.push(T),P.push(D);var B=Object(u.a)().domain([0,255]).range([0,1]);T.then((function(e){var t,n=e.embedding.values,r=e.embedding.categories,i={},l=s[0].endsWith("3d");for(var o in i[s[0]+"_1"]=new Float32Array(n[s[0]+"_1"]),i[s[0]+"_2"]=new Float32Array(n[s[0]+"_2"]),l&&(i[s[0]+"_3"]=new Float32Array(n[s[0]+"_3"])),n)if(!(o in i)){var u=i[s[0]+"_1"],f=i[s[0]+"_2"],g=i[s[0]+"_3"],y=n[o],k=null!=r[o],S=null,C=null,w=null;if(k){var P=r[o].values;(S=Object(p.a)(P.length<=10?h.a:P.length<=20?me:me.concat(fe)).domain(P)).valueCounts=r[o]}else{C=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(var x=0,_=y.length;x<_;x++){var D=y[x];C=D<C?D:C,w=D>w?D:w}(S=Object(d.a)(M.value).domain([C,w])).valueCounts=e.embedding.obs[o]}for(var T=[],U=0,I=y.length;U<I;U++){var L=Object(c.e)(S(y[U]));T.push([B(L.r),B(L.g),B(L.b)])}var N={hoverinfo:"text",showlegend:!1,name:o,mode:"markers",type:l?"scatter3d":"scattergl",hoveron:"points",x:u,y:f,marker:{size:v,color:T,opacity:b,showscale:!1},unselected:{marker:{opacity:O,size:E}},selectedpoints:j.indices&&0===j.indices.length?null:j.indices,values:y,text:y};l&&(N.z=g),N=[N];var z=A.createPlotLayout({embedding:!0,is3d:l,legend:!1,title:o});m.push({date:new Date,active:!0,domain:k?null:[C,w],colorScale:S,continuous:!k,data:N,name:o,layout:z,isCategorical:k})}m.sort((function(e,t){return(e=e.name.toLowerCase())<(t=t.name.toLowerCase())?-1:1})),a((t=m.slice(0),{type:oe,payload:t}))}))}Promise.all(P).finally((function(){a(Pe(!1))})).catch((function(e){Ie(a,e,"Unable to retrieve data. Please try again."),t&&t(e)}))}}}function Ie(e,t,a){if(console.log(t),401===t.status)return e(Me("Your session has expired. Please login again.")),e(ye());null==a&&(a=t instanceof b?t.message:"An unexpected error occurred. Please try again."),e(Me(new Error(a)))}function Le(){return function(e,t){return e(Pe(!0)),fetch(x+"/datasets",{headers:{Authorization:"Bearer "+Se()}}).then((function(e){return e.json()})).then((function(t){e({type:re,payload:t})})).finally((function(){e(Pe(!1))})).catch((function(t){Ie(e,t,"Unable to retrieve datasets. Please try again.")}))}}var Ne=a(240),ze=a(227),Ve=a(122),Re=a(232),Ge=a(228),Fe=a(217),We=a(219),Ke=a(234),qe=a(220),He=a(233),Ye=a(223),Xe=a(231),Je=a(58),Ze=a.n(Je),Qe=a(229),$e=a(117),et=a.n($e),tt=a(118),at=a.n(tt),nt=a(113),rt=a.n(nt),it=a(75),lt=a.n(it),ot=a(115),st=a.n(ot),ct=a(116),ut=a.n(ct),dt=a(210),pt=a(216),ht=a(215),mt=a(214),ft=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(f.a)(this,Object(g.a)(t).call(this,e))).handleClose=function(){a.props.handleCancel()},a.handleDelete=function(){a.setState({loading:!0}),a.props.handleDelete({dataset:a.props.dataset})},a.state={open:!0},a}return Object(y.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return r.a.createElement(dt.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"delete-dataset-dialog-title",fullWidth:!0,maxWidth:"sm"},r.a.createElement(mt.a,{id:"delete-dataset-dialog-title"},"Delete Dataset"),r.a.createElement(ht.a,null,r.a.createElement("h3",null,"Are you sure you want to delete ",this.props.dataset.name,"?")),r.a.createElement(pt.a,null,r.a.createElement(Fe.a,{disabled:this.state.loading,onClick:this.handleClose,color:"primary"},"Cancel"),r.a.createElement(Fe.a,{disabled:this.state.loading,onClick:this.handleDelete,color:"primary"},"Delete ",r.a.createElement(lt.a,null))))}}]),t}(r.a.PureComponent),gt=Object(l.b)((function(e){return{dataset:e.dataset,email:e.email}}),(function(e){return{handleDelete:function(t){e(we(t))},handleCancel:function(t){e(je(null))}}}))(ft),yt=a(77),vt=a.n(yt),bt=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(f.a)(this,Object(g.a)(t).call(this,e))).handleStart=function(e){},a.handleDrag=function(e,t){},a.handleStop=function(e){},a.ref=r.a.createRef(),a.backingScale=1,a}return Object(y.a)(t,e),Object(E.a)(t,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),a=this.props.height,n=this.props.width;t.clearRect(0,0,n*e,a*e),t.scale(e,e);var r=this.props.scale;if(null!=r){var i=r.domain();if(i[0]!==i[1]){for(var l=i[0],o=this.props.nsteps||10,s=(i[1]-i[0])/o,c=t.createLinearGradient(0,0,n,20),d=Object(u.a)().range([0,1]).domain(i).clamp(!0),p=0;p<o;p++){p===o-1&&(l=i[1]);var h=d(l);if(!isNaN(h)){var m=r(l);c.addColorStop(h,m)}l+=s}if(t.fillStyle=c,t.fillRect(0,0,n,20),t.strokeStyle="LightGrey",t.strokeRect(0,0,n,20),this.props.label>0){var f=Object(O.a)(".1f");t.font="12px Helvetica",t.textBaseline="top",t.fillStyle="black",t.textAlign="left",t.fillText(f(i[0]),0,22),t.textAlign="right",t.fillText(f(i[1]),n,22)}t.setTransform(1,0,0,1,0,0)}}}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"componentDidUpdate",value:function(e,t,a){this.redraw()}},{key:"render",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio),this.backingScale=e;var t=this.props.height,a=this.props.width,n={width:a,height:t,display:"block"};return this.props.style&&(n=Object.assign({},n,this.props.style)),r.a.createElement("canvas",{width:a*e,height:t*e,ref:this.ref,style:n})}}]),t}(r.a.PureComponent),Et=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(f.a)(this,Object(g.a)(t).call(this,e))).ref=r.a.createRef(),a.backingScale=1,a}return Object(y.a)(t,e),Object(E.a)(t,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),a=this.props.height,n=this.props.width;t.clearRect(0,0,n*e,a*e),t.scale(e,e);var r=this.props.scale;if(null!=r){var i=r.domain(),l=i[0],o=this.props.nsteps||3,s=(i[1]-i[0])/o,c=Object(u.a)().range([25,n-25]).domain([0,o-1]).clamp(!0),d=Object(u.a)().range([2,10]).domain(i).clamp(!0),p=Object(O.a)(".0f");t.font="12px Helvetica",t.textBaseline="top",t.fillStyle="black",t.textAlign="center";for(var h=0;h<o;h++){h===o-1&&(l=i[1]);var m=c(h),f=d(l);t.beginPath(),t.arc(m,10,f,0,2*Math.PI),t.stroke(),t.fillText(p(100*l),m,22),l+=s}t.setTransform(1,0,0,1,0,0)}}},{key:"componentDidUpdate",value:function(e,t,a){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"render",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio),this.backingScale=e;var t=this.props.height,a=this.props.width,n={width:a,height:t};return this.props.style&&(n=Object.assign({},n,this.props.style)),r.a.createElement("canvas",{width:a*e,height:t*e,ref:this.ref,style:n})}}]),t}(r.a.PureComponent),Ot=vt()(window.Plotly),kt=function(e){function t(){return Object(m.a)(this,t),Object(f.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){if(null==this.props.data)return r.a.createElement("div",null);var e=this.props.data,t=e.index||[""],a=Number.MAX_VALUE,n=-Number.MAX_VALUE,i=Number.MAX_VALUE,l=-Number.MAX_VALUE,o={};for(var s in e)if("index"!==s){var c=e[s],d=void 0,p=void 0,h=s.indexOf(","),m=s.substring(2,h-1),f=s.substring(h+3,s.length-2),g=o[m];void 0===g&&(g={},o[m]=g),"non_zero"===f?(d=i,p=l,g.fraction=c):"mean"===f?(d=a,p=n,g.summary=c):console.log("Unknown type: "+f+".");for(var y=0;y<c.length;y++)d=Math.min(d,c[y]),p=Math.max(p,c[y]);"non_zero"===f?(i=d,l=p):(a=d,n=p)}a===n&&n++,i===l&&(i=0,l=1);var v=Object(O.a)(".1f"),b=Object(u.a)().domain([a,n]).range(["blue","red"]),E=Object(u.a)().domain([i,l]).range([1,14]).clamp(!0),k=[],S=[],C=[],w=[],M=[],j=[];for(var P in o){j.push(P);for(var x=o[P],_=x.summary,D=x.fraction,T=0;T<_.length;T++)S.push(b(_[T])),k.push(E(D[T])),w.push(P),C.push(t[T]),M.push("mean: "+v(_[T])+", % non-zero: "+v(100*D[T]))}var B=[{type:"scatter",x:C,y:w,text:M,mode:"markers",name:"",sizemode:"diameter",marker:{color:S,symbol:"circle",size:k}}],U=A.createPlotConfig(),I=A.createPlotLayout({embedding:!1});return I.xaxis.type="category",I.yaxis.type="category",I.height=100+16*j.length,I.width=Math.max(300,70+16*t.length),r.a.createElement("div",{style:{maxWidth:800,overflow:"auto",border:"1px solid LightGrey"}},r.a.createElement(Ot,{data:B,embedding:I,config:U}),r.a.createElement(bt,{style:{display:"block"},width:300,label:!0,height:40,scale:b}),r.a.createElement(Et,{style:{display:"block"},width:150,label:!0,height:40,scale:E}))}}]),t}(r.a.PureComponent),St=Object(l.b)((function(e){return{data:e.dotPlotData}}),(function(e){return{}}))(kt),Ct=a(235),wt=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(f.a)(this,Object(g.a)(t).call(this,e))).handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.datasetName.trim(),t=a.state.url.trim();if(""!==e&&""!==t){a.setState({loading:!0});for(var n=a.state.readers.split(","),r=new Set,i=0;i<n.length;i++){var l=n[i].trim().toLowerCase();""!==l&&r.add(l)}var o=Array.from(r);a.props.handleSave({dataset:a.props.dataset,name:e,url:t,readers:o})}},a.onEmailChanged=function(e){a.setState({readers:e.target.value})},a.onUrlChanged=function(e){a.setState({url:e.target.value})},a.onDatasetNameChanged=function(e){a.setState({datasetName:e.target.value})},a.state={url:"",datasetName:null!=a.props.dataset?a.props.dataset.name:"",readers:"",loading:null!=a.props.dataset},a}return Object(y.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;null!=this.props.dataset&&fetch(x+"/dataset?id="+this.props.dataset.id,{method:"GET",headers:{Authorization:"Bearer "+Se()}}).then((function(e){return e.json()})).then((function(t){var a=[];for(var n in t.roles)"reader"===t[n]&&a.push(n);e.setState({datasetName:t.name,loading:!1,url:t.url,readers:a.join(", ")})})).catch((function(t){e.props.handleError("Unable to retrieve dataset details. Please try again."),e.props.handleCancel()}))}},{key:"render",value:function(){return r.a.createElement(dt.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-dataset-dialog-title",fullWidth:!0,maxWidth:"sm"},r.a.createElement(mt.a,{id:"edit-dataset-dialog-title"},null==this.props.dataset?"Import":"Edit"," Dataset"),r.a.createElement(ht.a,null,this.state.loading&&r.a.createElement(We.a,null),r.a.createElement(Ct.a,{disabled:this.state.loading,required:!0,value:this.state.datasetName,onChange:this.onDatasetNameChanged,margin:"dense",label:"Dataset name",fullWidth:!0}),!this.state.loading&&r.a.createElement(Ct.a,{required:!0,value:this.state.url,onChange:this.onUrlChanged,margin:"dense",helperText:"Please ensure that "+this.props.serverEmail+' has "Storage Object Viewer" permissions',label:"Dataset URL (e.g. gs://my_bucket/my_dataset.parquet)",fullWidth:!0}),!this.state.loading&&r.a.createElement(Ct.a,{value:this.state.readers,onChange:this.onEmailChanged,margin:"dense",label:"Comma separated list of emails to share with",fullWidth:!0,multiline:!0})),r.a.createElement(pt.a,null,r.a.createElement(Fe.a,{disabled:this.state.loading,onClick:this.handleClose,color:"primary"},"Cancel"),r.a.createElement(Fe.a,{disabled:this.state.loading,onClick:this.handleSave,color:"primary"},"Save")))}}]),t}(r.a.PureComponent),Mt=Object(l.b)((function(e){return{dataset:e.dialog===te?e.dataset:null,serverEmail:e.serverInfo.email}}),(function(e){return{handleSave:function(t){e(Ce(t))},handleCancel:function(t){e(je(null))},handleError:function(t){e(Me(t))}}}))(wt),jt=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(f.a)(this,Object(g.a)(t).call(this,e))).handleClick=function(e,t){t.preventDefault(),a.props.handleClick({name:a.props.name,value:e})},a}return Object(y.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this,t=this.props.scale,a=this.props.legendVisibility[this.props.name]||[],n=t.domain(),i=this.props.selectedValueCounts,l=null!=i.categories?i.categories[this.props.name]:null,o=j(l,t.valueCounts.values,t.valueCounts.counts);return r.a.createElement("div",{style:{display:"inline-block",padding:10,verticalAlign:"top"}},n.map((function(n,i){var s=M(l,t,o,i),c=-1!==a.indexOf(n)?.4:1;return r.a.createElement("div",{style:{opacity:c},onClick:function(t){return e.handleClick(n,t)},key:n},r.a.createElement("div",{style:{display:"inline-block",width:s.width,height:10,background:t(n)}}),r.a.createElement("label",{style:{marginLeft:4}},n+" - "+s.text))})))}}]),t}(r.a.PureComponent),Pt=(Object(O.a)(","),function(e){function t(){return Object(m.a)(this,t),Object(f.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props.style,t=this.props.scale,a=this.props.name,n=t.valueCounts.values,i=t.domain();i[0]===i[1]&&(n=[]);var l=this.props.selectedValueCounts,o=null!=l.categories?l.categories[a]:null;o&&(null!=o.True&&(o.true=o.True),null!=o.False&&(o.false=o.False));var s=j(o,t.valueCounts.values,t.valueCounts.counts);return r.a.createElement("div",{style:e},n.map((function(e,a){var n=e;1==n?n="expressed":0==n&&(n="not expressed");var i=M(o,t,s,a);return r.a.createElement("div",{key:e},r.a.createElement("div",{style:{display:"inline-block",width:i.width,height:10,background:"LightGrey"}}),r.a.createElement("label",{style:{marginLeft:4}},n+" - "+i.text))})),r.a.createElement(bt,{width:this.props.width,height:this.props.height,style:e,scale:t,label:this.props.label}))}}]),t}(r.a.PureComponent)),At=vt()(window.Plotly),xt=function(e){function t(){return Object(m.a)(this,t),Object(f.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(E.a)(t,[{key:"getPlots",value:function(){var e=this;return this.props.data.filter((function(e){return e.active})).map((function(t){return r.a.createElement("div",{style:{display:"inline-block",border:"1px solid LightGrey"},key:t.name},r.a.createElement(At,{key:t.name,data:t.data,layout:t.layout,config:e.props.config,onDeselect:e.props.onDeselect,onSelected:e.props.onSelect}),t.continuous?r.a.createElement(Pt,{style:{display:"block",marginLeft:"auto",marginRight:"auto"},width:300,label:!0,height:40,scale:t.colorScale,name:t.name,selectedValueCounts:e.props.selectedValueCounts}):r.a.createElement(jt,{legendVisibility:e.props.legendVisibility,handleClick:e.props.handleLegendClick,name:t.name,scale:t.colorScale,selectedValueCounts:e.props.selectedValueCounts}))}))}},{key:"render",value:function(){return this.getPlots()}}]),t}(r.a.PureComponent),_t=Object(l.b)((function(e){return{data:e.embeddingData,config:e.plotConfig,legendVisibility:e.legendVisibility,selectedValueCounts:e.selectedValueCounts}}),(function(e){return{handleLegendClick:function(t){e(be(t))},onSelect:function(t){e(Ee(t))},onDeselect:function(){e(Ee(null))},onZoom:function(){}}}))(xt),Dt=a(239),Tt=a(222),Bt=a(226),Ut=a(237),It=a(225),Lt=a(89),Nt=a(123),zt=a(238),Vt=a(218),Rt=a(90),Gt=a(6),Ft=a(86),Wt=a(61),Kt=a(112),qt=a.n(Kt),Ht=a(110),Yt=a.n(Ht),Xt=a(119);function Jt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Zt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Jt(a,!0).forEach((function(t){Object(Lt.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Jt(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Qt={display:"flex",alignItems:"center",justifyContent:"space-between"},$t=function(e){return r.a.createElement("div",{style:Qt},r.a.createElement("span",null,e.label))};function ea(e){var t=e.inputRef,a=Object(Nt.a)(e,["inputRef"]);return r.a.createElement("div",Object.assign({ref:t},a))}var ta={Control:function(e){return r.a.createElement(Ct.a,Object.assign({fullWidth:!0,InputProps:{inputComponent:ea,inputProps:Zt({className:e.selectProps.classes.input,inputRef:e.innerRef,children:e.children},e.innerProps)}},e.selectProps.textFieldProps))},Menu:function(e){return r.a.createElement(Rt.a,Object.assign({square:!0,className:e.selectProps.classes.paper},e.innerProps),e.children)},MultiValue:function(e){return r.a.createElement(zt.a,{tabIndex:-1,label:e.children,className:Yt()(e.selectProps.classes.chip,Object(Lt.a)({},e.selectProps.classes.chipFocused,e.isFocused)),onDelete:e.removeProps.onClick,deleteIcon:r.a.createElement(qt.a,e.removeProps)})},NoOptionsMessage:function(e){return r.a.createElement(Wt.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.noOptionsMessage},e.innerProps),e.children)},Option:function(e){return r.a.createElement(He.a,Object.assign({buttonRef:e.innerRef,selected:e.isFocused,component:"div",style:{fontWeight:e.isSelected?500:400}},e.innerProps),e.children)},Placeholder:function(e){return r.a.createElement(Wt.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.placeholder},e.innerProps),e.children)},SingleValue:function(e){return r.a.createElement(Wt.a,Object.assign({className:e.selectProps.classes.singleValue},e.innerProps),e.children)},ValueContainer:function(e){return r.a.createElement("div",{className:e.selectProps.classes.valueContainer},e.children)}},aa=function(e){function t(){var e,a;Object(m.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).loadOptions=function(e,t){return t(a.filterOptions(e))},a.noOptionsMessage=function(){return"No matches"},a.onChange=function(e){a.props.isMulti?a.props.onChange(null==e||0===e.length?null:e.map((function(e){return e.value}))):a.props.onChange(e)},a.filterOptions=function(e){if(e){for(var t=1===(e=e.toLowerCase()).length?3:2===e.length?10:20,n=0,r=[],i=0,l=a.props.options.length;i<l;i++){var o=a.props.options[i],s={label:o.label,options:[]};r.push(s);for(var c=0,u=o.options.length;c<u;c++){var d=o.options[c];if(d.value.toLowerCase().startsWith(e)&&(n++,s.options.push(d),n===t))return r}}return r}return[]},a}return Object(y.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.theme,n={input:function(e){return Zt({},e,{color:a.palette.text.primary,"& input":{font:"inherit"}})}};return r.a.createElement("div",{className:t.root},r.a.createElement(Vt.a,null,r.a.createElement(Xt.a,{noOptionsMessage:this.noOptionsMessage,cacheOptions:!1,placeholder:"",loadOptions:this.loadOptions,classes:t,styles:n,textFieldProps:{label:this.props.label,helperText:this.props.helperText,InputLabelProps:{shrink:!0}},formatGroupLabel:$t,components:ta,onChange:this.onChange,value:this.props.value,isMulti:this.props.isMulti,defaultOptions:this.props.defaultOptions})))}}]),t}(r.a.Component),na=Object(Gt.a)((function(e){return{root:{flexGrow:1},input:{display:"flex",padding:0,maxWidth:"220px",height:"100%"},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:"".concat(e.spacing(1)/2,"px ").concat(e.spacing(1)/4,"px")},chipFocused:{backgroundColor:Object(Ft.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:"".concat(e.spacing(1),"px ").concat(2*e.spacing(1),"px")},singleValue:{fontSize:16},placeholder:{position:"absolute",left:2,fontSize:16},paper:{position:"absolute",zIndex:1,marginTop:e.spacing(1),left:0,right:0},divider:{height:2*e.spacing(1)}}}),{withTheme:!0})(aa),ra=function(e){function t(){var e,a;Object(m.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).handleInterpolatorChange=function(e){var t=e.target.value;a.props.handleInterpolator({name:t,value:P(t)})},a}return Object(y.a)(t,e),Object(E.a)(t,[{key:"getScale",value:function(e){return Object(d.a)(k[e]).domain([0,1])}},{key:"render",value:function(){var e=this,t=this.props.classes;return r.a.createElement(Xe.a,{input:r.a.createElement(qe.a,{id:"color-scheme"}),className:t.select,onChange:this.handleInterpolatorChange,value:this.props.interpolator.name,multiple:!1},r.a.createElement(He.a,{key:"Diverging",value:"Diverging",divider:!0,disabled:!0},"Diverging"),S.Diverging.map((function(t){return r.a.createElement(He.a,{value:t,key:t},r.a.createElement(bt,{width:200,label:!1,height:24,scale:e.getScale(t)}))})),r.a.createElement(He.a,{key:"Sequential (Single Hue)",value:"Sequential (Single Hue)",divider:!0,disabled:!0},"Sequential (Single Hue)"),S["Sequential (Single Hue)"].map((function(t){return r.a.createElement(He.a,{value:t,key:t},r.a.createElement(bt,{width:200,label:!1,height:20,scale:e.getScale(t)}))})),r.a.createElement(He.a,{key:"Sequential (Multi-Hue)",value:"Sequential (Multi-Hue)",divider:!0,disabled:!0},"Sequential (Multi-Hue)"),S["Sequential (Multi-Hue)"].map((function(t){return r.a.createElement(He.a,{value:t,key:t},r.a.createElement(bt,{width:200,label:!1,height:20,scale:e.getScale(t)}))})),r.a.createElement(He.a,{key:"Cyclical",value:"Cyclical",divider:!0,disabled:!0},"Cyclical"),S.Cyclical.map((function(t){return r.a.createElement(He.a,{value:t,key:t},r.a.createElement(bt,{width:200,label:!1,height:20,scale:e.getScale(t)}))})))}}]),t}(r.a.PureComponent),ia=Ze()((function(e){return{root:{display:"flex",flexWrap:"wrap","flex-direction":"column"},formControl:{display:"block",margin:e.spacing(1),minWidth:200},select:{minWidth:200}}}))(Object(l.b)((function(e){return{interpolator:e.interpolator}}),(function(e){return{handleInterpolator:function(t){e({type:J,payload:t})}}}))(ra)),la=function(e){function t(){var e,a;Object(m.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).onMarkerSizeChange=function(e){a.props.handleMarkerSizeUI(e.target.value)},a.onMarkerSizeKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);t>0&&a.props.handleMarkerSize(t)}},a.onUnselectedMarkerSizeChange=function(e){a.props.handleUnselectedMarkerSizeUI(e.target.value)},a.onUnselectedMarkerSizeKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);t>0&&a.props.handleUnselectedMarkerSize(t)}},a.onMarkerOpacityChange=function(e){a.props.handleMarkerOpacityUI(e.target.value)},a.onMarkerOpacityKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);t>0&&t<=1&&a.props.handleMarkerOpacity(t)}},a.onUnselectedMarkerOpacityChange=function(e){a.props.handleUnselectedMarkerOpacityUI(e.target.value)},a.onUnselectedMarkerOpacityKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);t>0&&t<=1&&a.props.handleUnselectedMarkerOpacity(t)}},a.onNumberOfBinsChange=function(e){a.props.handleNumberOfBinsUI(e.target.value)},a.onNumberOfBinsKeyPress=function(e){if("Enter"===e.key){var t=parseInt(e.target.value);t>0&&a.props.handleNumberOfBins(t)}},a.onBinSummaryChange=function(e){a.props.handleBinSummary(e.target.value)},a.handleBinValuesChange=function(e){a.props.handleBinValues(e.target.checked)},a.handleViewChange=function(e){a.props.handleViewName(e.target.value)},a}return Object(y.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.unselectedMarkerSize,n=e.selectedFeatures,i=e.selectedGroupBy,l=e.selectedEmbeddings,o=e.numberOfBins,s=e.markerSize,c=e.markerOpacity,u=e.unselectedMarkerOpacity,d=e.binValues,p=e.binSummary,h=e.dataset,m=null==h?[]:h.features,f=null==h?[]:h.embeddings,g=null==h?[]:h.obsCat,y=null==h?[]:h.obs,v=n.concat(i);v=v.map((function(e){return{label:e,value:e}}));var b=y.map((function(e){return{label:e,value:e}}));(b=b.concat(g.map((function(e){return{label:e,value:e,categorical:!0}})))).sort((function(e,t){return(e=e.label.toLowerCase())<(t=t.label.toLowerCase())?-1:e==t?0:1}));var E=[{label:"Annotations",options:b},{label:"Variables",options:m.map((function(e){return{label:e,value:e}}))}],O=[{label:"Annotations",options:b},{label:"Variables",options:[{isDisabled:!0,label:"Type to search",value:""}]}];return r.a.createElement("div",{className:t.root},r.a.createElement(Tt.a,{className:t.formControl},r.a.createElement(Ut.a,{htmlFor:"view"},"Embedding"),r.a.createElement(Xe.a,{className:t.select,input:r.a.createElement(qe.a,{id:"view"}),onChange:this.handleViewChange,value:0===l.length?"":l[0],multiple:!1},f.map((function(e){return r.a.createElement(He.a,{key:e.name,value:e.name},r.a.createElement(It.a,{primary:e.name}))})))),r.a.createElement(Tt.a,{className:t.formControl},r.a.createElement(na,{label:"Features",options:E,defaultOptions:O,value:v,onChange:this.props.handleFeatures,isMulti:!0})),r.a.createElement(Ct.a,{type:"number",step:"2",min:"0.1",max:"30",onKeyPress:this.onMarkerSizeKeyPress,onChange:this.onMarkerSizeChange,label:"Marker Size",className:t.formControl,value:s}),r.a.createElement(Ct.a,{step:"0.1",type:"number",min:"0.01",max:"1",onKeyPress:this.onMarkerOpacityKeyPress,onChange:this.onMarkerOpacityChange,label:"Marker Opacity",className:t.formControl,value:c}),r.a.createElement(Bt.a,{control:r.a.createElement(Dt.a,{checked:d,value:"binPlot",onChange:this.handleBinValuesChange}),label:"Bin Plot"}),r.a.createElement(Tt.a,{className:t.formControl},r.a.createElement(Ut.a,{htmlFor:"color-scheme"},"Color Scheme"),r.a.createElement(ia,null)),d&&r.a.createElement(Ct.a,{max:"1000",min:"20",step:"100",onKeyPress:this.onNumberOfBinsKeyPress,value:o,onChange:this.onNumberOfBinsChange,label:"# Bins Per Axis",className:t.formControl}),d&&r.a.createElement(Tt.a,{className:t.formControl},r.a.createElement(Ut.a,{htmlFor:"summary"},"Bin Summary"),r.a.createElement(Xe.a,{className:t.select,input:r.a.createElement(qe.a,{id:"summary"}),onChange:this.onBinSummaryChange,value:p},[{value:"min",label:"Minimum"},{value:"max",label:"Maximum"},{value:"mean",label:"Mean"},{value:"sum",label:"Sum"}].map((function(e){return r.a.createElement(He.a,{key:e.value,value:e.value},r.a.createElement(It.a,{primary:e.label}))})))),r.a.createElement(Ct.a,{type:"number",step:"2",min:"0.1",max:"30",onKeyPress:this.onUnselectedMarkerSizeKeyPress,onChange:this.onUnselectedMarkerSizeChange,label:"Unselected Marker Size",className:t.formControl,value:a}),r.a.createElement(Ct.a,{step:"0.1",type:"number",min:"0.01",max:"1",onKeyPress:this.onUnselectedMarkerOpacityKeyPress,onChange:this.onUnselectedMarkerOpacityChange,label:"Unselected Marker Opacity",className:t.formControl,value:u}))}}]),t}(r.a.PureComponent),oa=Ze()((function(e){return{root:{display:"flex",flexWrap:"wrap","flex-direction":"column"},formControl:{display:"block",margin:e.spacing(1),minWidth:200},select:{minWidth:200}}}))(Object(l.b)((function(e){return{selectedFeatures:e.features,selectedGroupBy:e.groupBy,selectedEmbeddings:e.embeddings,numberOfBins:e.numberOfBinsUI,markerSize:e.markerSizeUI,unselectedMarkerSize:e.unselectedMarkerSizeUI,markerOpacity:e.markerOpacityUI,unselectedMarkerOpacity:e.unselectedMarkerOpacityUI,binValues:e.binValues,binSummary:e.binSummary,dataset:e.dataset}}),(function(e,t){return{handleNumberOfBins:function(t){var a;e((a=t,function(e,t){if(t().numberOfBins!==a){var n=t().numberOfBins;e({type:q,payload:a}),e(Ue({embedding:!0,clear:!0},(function(t){e({type:q,payload:n})})))}}))},handleNumberOfBinsUI:function(t){e({type:ue,payload:t})},handleMarkerSize:function(t){e({type:z,payload:t})},handleMarkerSizeUI:function(t){e({type:de,payload:t})},handleUnselectedMarkerSize:function(t){e({type:D,payload:t})},handleUnselectedMarkerSizeUI:function(t){e({type:T,payload:t})},handleMarkerOpacity:function(t){e({type:V,payload:t})},handleMarkerOpacityUI:function(t){e({type:pe,payload:t})},handleUnselectedMarkerOpacity:function(t){e({type:R,payload:t})},handleUnselectedMarkerOpacityUI:function(t){e({type:he,payload:t})},handleBinSummary:function(t){var a;e((a=t,function(e,t){var n=t().binSummary;e({type:Y,payload:a}),e(Ue({embedding:!0,clear:!0},(function(t){e({type:Y,payload:n})})))}))},handleBinValues:function(t){var a;e((a=t,function(e,t){var n=t().binValues;e({type:H,payload:a}),e(Ue({embedding:!0,clear:!0},(function(t){e({type:H,payload:n})})))}))},handleViewName:function(t){e(Te(null==t?[]:[t]))},handleFeatures:function(t){e(De(null==t?[]:t))}}}))(la)),sa=5,ca=1,ua=.1,da="mean",pa=500,ha="Viridis",ma={name:ha,value:P(ha)};var fa=Object(o.c)({binSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:da,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Y:return t.payload;case $:return da;case ie:return null!=t.payload.binSummary?t.payload.binSummary:e;default:return e}},binValues:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case H:return t.payload;case $:return!1;case ie:return null!=t.payload.binValues?t.payload.binValues:e;default:return e}},dataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case $:return t.payload;default:return e}},datasetChoices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case re:return t.payload;case Z:return null==t.payload?[]:e;case I:return(e=e.concat([t.payload])).sort((function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:1})),e;case N:case L:for(var a=-1,n=0;n<e.length;n++)if(e[n].id===t.payload.id){a=n;break}return-1!==a?(t.type===N?e[a]=t.payload:e.splice(a,1),e.slice()):e;default:return e}},dialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ee:return t.payload;default:return e}},dotPlotData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case le:return t.payload;case $:return null;default:return e}},email:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Z:return t.payload;default:return e}},embeddingData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case oe:return t.payload;case z:return e.forEach((function(e){e.data.forEach((function(e){e.marker.size=t.payload})),e.data=e.data.slice()})),e.slice();case G:var a=t.payload.indices;return e.forEach((function(e){e.data.forEach((function(e){e.selectedpoints=a})),e.data=e.data.slice()})),e.slice();case J:var n=Object(u.a)().domain([0,255]).range([0,1]);return e.forEach((function(e){if(e.continuous){var a=Object(d.a)(t.payload.value).domain(e.colorScale.domain());e.data.forEach((function(e){for(var t=[],r=0,i=e.values.length;r<i;r++){var l=Object(c.e)(a(e.values[r]));t.push([n(l.r),n(l.g),n(l.b)])}e.marker.color=t})),e.colorScale=a}e.data=e.data.slice()})),e.slice();case V:return e.forEach((function(e){e.data.forEach((function(e){e.marker.opacity=t.payload})),e.data=e.data.slice()})),e.slice();case R:return e.forEach((function(e){e.data.forEach((function(e){e.unselected.marker.opacity=t.payload})),e.data=e.data.slice()})),e.slice();case D:return e.forEach((function(e){e.data.forEach((function(e){e.unselected.marker.size=t.payload})),e.data=e.data.slice()})),e.slice();case $:return[];default:return e}},embeddings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case K:return t.payload;case $:return[];case ie:return null!=t.payload.embeddings?t.payload.embeddings:e;default:return e}},features:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return t.payload;case $:return[];case ie:return t.payload.features||[];default:return e}},groupBy:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case W:return t.payload;case $:return[];case ie:return t.payload.groupBy||[];default:return e}},interpolator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ma,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case J:return t.payload;case ie:return null!=t.payload.colorScheme?t.payload.colorScheme:e;default:return e}},legendVisibility:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case U:return t.payload;default:return e}},loading:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case se:return t.payload;default:return e}},loadingApp:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ce:return t.payload;default:return e}},markerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ca,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case V:return t.payload;case $:return ca;case ie:return null!=t.payload.markerOpacity?t.payload.markerOpacity:e;default:return e}},markerOpacityUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case V:case pe:return t.payload;case $:return ca;case ie:return null!=t.payload.markerOpacity?t.payload.markerOpacity:e;default:return e}},markerSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case z:return t.payload;case $:return sa;case ie:return null!=t.payload.markerSize?t.payload.markerSize:e;default:return e}},markerSizeUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case z:case de:return t.payload;case $:return sa;case ie:return null!=t.payload.markerSize?t.payload.markerSize:e;default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case X:return t.payload;default:return e}},numberOfBins:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case q:return t.payload;case $:return pa;case ie:return null!=t.payload.numberOfBins?t.payload.numberOfBins:e;default:return e}},numberOfBinsUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case q:case ue:return t.payload;case $:return pa;case ie:return null!=t.payload.numberOfBins?t.payload.numberOfBins:e;default:return e}},plotConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch((arguments.length>1?arguments[1]:void 0).type){case $:return A.createPlotConfig();default:return e}},selectedValueCounts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case G:return t.payload;case $:return{};default:return e}},serverInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case B:return t.payload;default:return e}},unselectedMarkerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ua,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:return t.payload;case $:return ua;case ie:return null!=t.payload.unselectedMarkerOpacity?t.payload.unselectedMarkerOpacity:e;default:return e}},unselectedMarkerSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D:return t.payload;case $:return sa;case ie:return null!=t.payload.unselectedMarkerSize?t.payload.unselectedMarkerSize:e;default:return e}},unselectedMarkerSizeUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D:case T:return t.payload;case $:return sa;case ie:return null!=t.payload.unselectedMarkerSize?t.payload.unselectedMarkerSize:e;default:return e}},unselectedMarkerOpacityUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ua,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:case he:return t.payload;case $:return ua;case ie:return null!=t.payload.unselectedMarkerOpacity?t.payload.unselectedMarkerOpacity:e;default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Q:return t.payload;default:return e}}}),ga=Object(O.a)(","),ya=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(f.a)(this,Object(g.a)(t).call(this,e))).handleUserMenuClose=function(){a.setState({userMenuOpen:!1})},a.handleMessageClose=function(){a.props.setMessage(null)},a.handleUserMenuOpen=function(e){a.setState({userMenuOpen:!0,userMenuAnchorEl:e.currentTarget})},a.handleLinkMenuClose=function(e){a.setState({linkMenuOpen:!1,linkMenuAnchorEl:null})},a.copyLink=function(){a.linkRef.current.focus(),a.linkRef.current.select(),document.execCommand("copy"),a.props.setMessage("Link copied")},a.handleLinkMenuOpen=function(e){var t=window.location.protocol+"//"+window.location.host,n={dataset:a.props.dataset.id,features:a.props.features,groupBy:a.props.groupBy,embedding:a.props.embedding};a.props.markerSize!==sa&&(n.markerSize=a.props.markerSize),a.props.markerOpacity!==ca&&(n.markerOpacity=a.props.markerOpacity),a.props.binValues&&(n.binValues=!0,a.props.binSummary!==da&&(n.binSummary=a.props.binSummary),a.props.numberOfBins!==pa&&(n.numberOfBins=a.props.numberOfBins)),a.props.view3d&&(n["3d"]=!0),a.props.interpolator.name!==ha&&(n.colorScheme=a.props.interpolator.name),t+="?q="+JSON.stringify(n),a.setState({linkMenuOpen:!0,linkMenuAnchorEl:e.currentTarget,linkText:t})},a.handleLogout=function(){a.setState({userMenuOpen:!1}),a.props.handleLogout()},a.handleDataset=function(e){"importDataset"===e.target.value?a.props.handleDialog(ae):a.props.handleDataset(e.target.value)},a.handleSettings=function(e){a.props.handleDialog(te)},a.handleDelete=function(e){a.props.handleDialog(ne)},a.state={userMenuOpen:!1,linkMenuOpen:!1,userMenuAnchorEl:null,linkMenuAnchorEl:null,linkText:null},a.linkRef=r.a.createRef(),a}return Object(y.a)(t,e),Object(E.a)(t,[{key:"componentDidUpdate",value:function(e,t,a){var n=this;this.state.linkMenuOpen&&window.requestAnimationFrame((function(){n.linkRef.current.focus(),n.linkRef.current.select()}))}},{key:"render",value:function(){var e=this.props.classes;return r.a.createElement("div",{className:e.root},(this.props.dialog===te||this.props.dialog===ae)&&r.a.createElement(Mt,null),this.props.dialog===ne&&r.a.createElement(gt,null),r.a.createElement(Ge.a,{position:"fixed",color:"default",className:e.appBar},r.a.createElement(Qe.a,{variant:"dense"},r.a.createElement("div",null,r.a.createElement(rt.a,{style:{verticalAlign:"bottom"},fontSize:"large"}),r.a.createElement("h3",{style:{display:"inline",marginRight:20}},"Cirrocumulus"),this.props.loadingApp&&r.a.createElement("span",null,"Loading..."),null!=this.props.email&&r.a.createElement(Xe.a,{disableUnderline:!0,displayEmpty:!0,value:null==this.props.dataset?"":this.props.dataset.id,onChange:this.handleDataset,inputProps:{name:"dataset",id:"dataset-id"}}," ",this.props.datasetChoices.length>0&&r.a.createElement(He.a,{key:"",value:"",disabled:!0},"Choose a dataset"),this.props.datasetChoices.map((function(e){return r.a.createElement(He.a,{key:e.id,value:e.id},e.name)})),this.props.user.importer&&this.props.datasetChoices.length>0&&r.a.createElement("hr",null),this.props.user.importer&&r.a.createElement(He.a,{key:"importDataset",value:"importDataset"},"Import...")),r.a.createElement("div",{style:{display:"inline-block",marginLeft:"10px"}},null!=this.props.dataset&&this.props.dataset.nObs>0&&this.props.selectedValueCounts.count>0&&ga(this.props.selectedValueCounts.count)+" / "+ga(this.props.dataset.nObs)+" cells",null!=this.props.dataset&&!(this.props.selectedValueCounts.count>0)&&this.props.dataset.nObs>0&&ga(this.props.dataset.nObs)+" cells")),r.a.createElement("div",{style:{marginLeft:"auto"}},null!=this.props.dataset&&r.a.createElement(Ne.a,{title:"Link"},r.a.createElement(ze.a,{"aria-owns":this.state.linkMenuOpen?"link-popper":void 0,"aria-haspopup":"true",onClick:this.handleLinkMenuOpen,"aria-label":"Link"},r.a.createElement(st.a,null))),null!==this.props.dataset&&this.props.dataset.owner&&r.a.createElement(Ne.a,{title:"Edit"},r.a.createElement(ze.a,{onClick:this.handleSettings,"aria-label":"Edit"},r.a.createElement(ut.a,null))),null!==this.props.dataset&&this.props.dataset.owner&&r.a.createElement(Ne.a,{title:"Delete"},r.a.createElement(ze.a,{onClick:this.handleDelete,"aria-label":"Delete"},r.a.createElement(lt.a,null))),null!=this.props.dataset&&r.a.createElement(Ye.a,{id:"link-popper",open:this.state.linkMenuOpen,anchorEl:this.state.linkMenuAnchorEl,onClose:this.handleLinkMenuClose,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},r.a.createElement("div",{style:{padding:10}},r.a.createElement("h4",null,"Copy link to share your current view"),r.a.createElement(Fe.a,{variant:"outlined",onClick:this.copyLink},"Copy")," ",r.a.createElement(qe.a,{autoFocus:!0,inputRef:this.linkRef,readOnly:!0,value:this.state.linkText}))),null!=this.props.email&&r.a.createElement(Ne.a,{title:this.props.email},r.a.createElement(ze.a,{style:{marginLeft:50},"aria-label":"Menu","aria-haspopup":"true",onClick:this.handleUserMenuOpen},r.a.createElement(et.a,null))),null!=this.props.email&&r.a.createElement(Ve.a,{id:"menu-user",anchorEl:this.state.userMenuAnchorEl,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.userMenuOpen,onClose:this.handleUserMenuClose},r.a.createElement(He.a,{onClick:this.handleLogout},"Sign Out")),!this.props.loadingApp&&null==this.props.email&&r.a.createElement(Fe.a,{style:{whiteSpace:"nowrap"},variant:"outlined",color:"primary",onClick:this.props.handleLogin},"Sign In")))),r.a.createElement(Ke.a,{className:e.drawer,variant:"permanent",classes:{paper:e.drawerPaper},anchor:"left"},null!=this.props.dataset&&r.a.createElement(oa,{key:this.props.dataset.id})),r.a.createElement("div",null),r.a.createElement("main",{className:e.content},null!=this.props.dataset&&r.a.createElement(_t,null),null!=this.props.dataset&&r.a.createElement(St,null)),this.props.loading&&r.a.createElement(Re.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},ContentProps:{"aria-describedby":"loading-id"},open:!0,message:r.a.createElement("span",{id:"loading-id"},r.a.createElement(We.a,{size:20})," Loading...")}),null!=this.props.message&&r.a.createElement(Re.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},ContentProps:{"aria-describedby":"message-id"},onClose:this.handleMessageClose,open:!0,autoHideDuration:6e3,action:[r.a.createElement(ze.a,{key:"close","aria-label":"Close",color:"inherit",onClick:this.handleMessageClose},r.a.createElement(at.a,null))],message:r.a.createElement("span",{id:"message-id"},this.props.message instanceof Error?this.props.message.message:this.props.message)}))}}]),t}(n.PureComponent),va=Ze()((function(e){return{root:{display:"flex"},appBar:{width:"calc(100% - ".concat(240,"px)"),marginLeft:240},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},toolbar:e.mixins.toolbar,content:{flexGrow:1,backgroundColor:e.palette.background.default,paddingTop:e.spacing(6.5),paddingLeft:e.spacing(1)}}}))(Object(l.b)((function(e){return{message:e.message,loadingApp:e.loadingApp,loading:e.loading,dialog:e.dialog,email:e.email,dataset:e.dataset,datasetChoices:e.datasetChoices,selectedValueCounts:e.selectedValueCounts,features:e.features,groupBy:e.groupBy,markerSize:e.markerSize,markerOpacity:e.markerOpacity,embedding:e.embedding,view3d:e.view3d,numberOfBins:e.numberOfBins,binSummary:e.binSummary,binValues:e.binValues,interpolator:e.interpolator,selectedpoints:e.selectedpoints,user:e.user}}),(function(e){return{handleLogin:function(){e((function(e,t){window.gapi.auth2.getAuthInstance().signIn().then((function(t){e(ke())}))}))},handleLogout:function(){e(ye())},handleDataset:function(t){e(Be(t))},handleDialog:function(t){e(je(t))},setMessage:function(t){e(Me(t))}}}))(ya)),ba=a(224),Ea=a(120),Oa=Object(Ea.a)({palette:{type:"light"}}),ka=Object(o.d)(fa,Object(o.a)(s.a));ka.dispatch((function(e,t){fetch(x+"/server").then((function(e){return e.json()})).then((function(t){if(""==t.clientId)e(Ae(!1)),e(_e("")),e(Le()).then((function(){e(Oe()),e((function(e,t){null==t().dataset&&1===t().datasetChoices.length&&e(Be(t().datasetChoices[0].id))}))}));else{var a=document.createElement("script");a.type="text/javascript",a.src="https://apis.google.com/js/api.js",e({type:B,payload:t}),a.onload=function(a){window.gapi.load("client:auth2",(function(){window.gapi.client.init({clientId:t.clientId,discoveryDocs:[],scope:_.join(" ")}).then((function(){e(Ae(!1)),e(ke(!0))}))}))},document.getElementsByTagName("head")[0].appendChild(a)}}))})),Object(i.render)(r.a.createElement(l.a,{store:ka},r.a.createElement(ba.a,{theme:Oa},r.a.createElement(va,null))),document.getElementById("root"))}},[[146,1,2]]]);
//# sourceMappingURL=main.befefd3d.chunk.js.map